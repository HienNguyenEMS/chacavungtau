<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Äá»“ng NhÃ¢n Food - BÃ¡nh MÃ¬ & Thá»±c Pháº©m Sáº¡ch</title>
    
    <meta name="description" content="Äá»“ng NhÃ¢n Food chuyÃªn cung cáº¥p bÃ¡nh mÃ¬, cháº£ cÃ¡ vÃ  cÃ¡c sáº£n pháº©m thá»±c pháº©m sáº¡ch. Nháº­n Ä‘áº·t hÃ ng online vÃ  nhÆ°á»£ng quyá»n kinh doanh.">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%); }
        .card-shadow { box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        .interactive-card {
            transition: all 0.3s ease-in-out;
            border: 2px solid #a7f3d0;
        }
        .interactive-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 20px rgba(16, 185, 129, 0.2);
            border-color: #059669;
        }
        .dropdown { position: relative; }
        .dropdown-menu { 
            position: absolute; top: 100%; right: 0; background: white; 
            border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); 
            min-width: 200px; z-index: 50; transform: translateY(10px) scale(0.95);
            opacity: 0; visibility: hidden; transition: all 0.2s ease; 
        }
        .dropdown-menu.show { transform: translateY(0) scale(1); opacity: 1; visibility: visible; }
        .mobile-nav-btn.active { color: #059669; background-color: #f0fdf4; }
        .dashboard-tab.active { border-bottom-width: 2px; border-color: #059669; color: #059669; }
        .category-btn.active { background-color: #059669; color: white; border-color: #059669; }
        @media (max-width: 768px) {
            main { padding-bottom: 80px; }
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        main > section { padding-top: 2rem; padding-bottom: 2rem; }
        main > section > div { margin-bottom: 2.5rem; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3 cursor-pointer" onclick="showSection('intro')">
                    <img src="https://raw.githubusercontent.com/HienNguyenEMS/chacavungtau/refs/heads/main/logo.jpg" alt="Logo" class="w-10 h-10 rounded-lg">
                    <div><h1 class="text-xl font-bold">Äá»“ng NhÃ¢n Food</h1></div>
                </div>
                <nav class="hidden md:flex space-x-5 items-center">
                    <button onclick="showSection('intro')" class="hover:text-amber-300 transition-colors">Trang chá»§</button>
                    <button onclick="showSection('menu')" class="hover:text-amber-300 transition-colors">Sáº£n pháº©m</button>
                    <button onclick="showSection('stores')" class="hover:text-amber-300 transition-colors">Cá»­a hÃ ng</button>
                    <button id="navCart" onclick="showSection('cart')" class="hover:text-amber-300 transition-colors relative hidden">
                        Giá» hÃ ng <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                    </button>
                    <div id="userMenuContainer" class="relative">
                        <div id="notLoggedIn" class="flex space-x-3">
                            <button onclick="showSection('login')" class="bg-white bg-opacity-20 px-3 py-1.5 rounded-lg hover:bg-opacity-30">ÄÄƒng nháº­p</button>
                            <button onclick="showSection('register')" class="bg-amber-400 text-slate-800 px-3 py-1.5 rounded-lg hover:bg-amber-300 font-semibold">ÄÄƒng kÃ½</button>
                        </div>
                        <div id="loggedIn" class="hidden">
                            <div class="dropdown">
                                <button onclick="toggleUserDropdown()" class="flex items-center space-x-2 bg-white bg-opacity-20 px-3 py-1.5 rounded-lg hover:bg-opacity-30">
                                    <span class="text-xl">ğŸ‘¤</span><span id="userName" class="font-medium"></span>
                                    <svg class="w-4 h-4 transition-transform" id="userDropdownIcon" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                                </button>
                                <div id="userDropdownMenu" class="dropdown-menu">
                                    <button onclick="showSection('dashboard'); closeUserDropdown();" class="w-full text-left px-4 py-2 text-gray-700 hover:bg-emerald-50 flex items-center space-x-2"><span>ğŸ“Š</span><span>Dashboard</span></button>
                                    <hr class="my-1">
                                    <button onclick="logout(); closeUserDropdown();" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 flex items-center space-x-2"><span>ğŸšª</span><span>ÄÄƒng xuáº¥t</span></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>
    
    <!-- Mobile Bottom Navigation -->
    <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t z-40">
        <div id="mobileNavGrid" class="grid grid-cols-3 h-16">
            <button onclick="showSection('intro')" class="mobile-nav-btn flex flex-col items-center justify-center space-y-1 text-gray-600" data-section="intro">
                <span class="text-xl">ğŸ </span><span class="text-xs font-medium">Trang chá»§</span>
            </button>
            <button onclick="showSection('menu')" class="mobile-nav-btn flex flex-col items-center justify-center space-y-1 text-gray-600 active" data-section="menu">
                <span class="text-xl">ğŸ¥–</span><span class="text-xs font-medium">Sáº£n pháº©m</span>
            </button>
            <button id="mobileNavCart" onclick="showSection('cart')" class="mobile-nav-btn flex-col items-center justify-center space-y-1 text-gray-600 relative hidden" data-section="cart">
                <span class="text-xl">ğŸ›’</span><span class="text-xs font-medium">Giá» hÃ ng</span>
                <span id="mobileCartCount" class="absolute top-1 right-4 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
            </button>
             <button onclick="isLoggedIn ? showSection('dashboard') : showSection('login')" class="mobile-nav-btn flex flex-col items-center justify-center space-y-1 text-gray-600" data-section="login">
                <span class="text-xl">ğŸ‘¤</span><span class="text-xs font-medium">TÃ i khoáº£n</span>
            </button>
        </div>
    </div>

    <main class="container mx-auto px-4">
        <section id="introSection" class="hidden animate-fade-in"></section>
        <section id="menuSection" class="animate-fade-in"></section>
        <section id="storesSection" class="hidden animate-fade-in"></section>
        <section id="cartSection" class="hidden animate-fade-in"></section>
        <section id="loginSection" class="hidden animate-fade-in"></section>
        <section id="registerSection" class="hidden animate-fade-in"></section>
        <section id="dashboardSection" class="hidden animate-fade-in"></section>
        <section id="franchiseSection" class="hidden animate-fade-in"></section>
    </main>
    
    <footer class="bg-gray-800 text-white pt-10 pb-5">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-6">
                <div>
                    <div class="flex items-center space-x-2 mb-3">
                        <img src="https://raw.githubusercontent.com/HienNguyenEMS/chacavungtau/refs/heads/main/logo.jpg" alt="Logo" class="w-10 h-10 rounded-lg">
                        <span class="font-bold text-lg">Äá»“ng NhÃ¢n Food</span>
                    </div>
                    <p class="text-gray-400 text-sm">Mang nhá»¯ng sáº£n pháº©m cháº¥t lÆ°á»£ng, an toÃ n vÃ  tiá»‡n lá»£i Ä‘áº¿n má»i nhÃ .</p>
                </div>
                <div>
                    <h3 class="font-bold mb-3">LiÃªn káº¿t nhanh</h3>
                    <ul class="space-y-1.5 text-gray-400 text-sm">
                        <li><a href="#" onclick="event.preventDefault(); showSection('intro')" class="hover:text-white">Trang chá»§</a></li>
                        <li><a href="#" onclick="event.preventDefault(); showSection('menu')" class="hover:text-white">Sáº£n pháº©m</a></li>
                        <li><a href="#" onclick="event.preventDefault(); showSection('stores')" class="hover:text-white">Cá»­a hÃ ng</a></li>
                        <li><a href="#" onclick="event.preventDefault(); handleFranchiseClick()" class="hover:text-white">ÄÄƒng kÃ½ nhÆ°á»£ng quyá»n</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-3">LiÃªn há»‡</h3>
                    <ul class="space-y-1.5 text-gray-400 text-sm">
                        <li><strong>Hotline:</strong> 0934.945.967</li>
                        <li><strong>Email:</strong> lienhe@dongnhanfood.com</li>
                        <li><strong>Trá»¥ sá»Ÿ:</strong> 3/564 áº¤p 64, XuÃ¢n Thá»›i SÆ¡n, TPHCM</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-3">Máº¡ng xÃ£ há»™i</h3>
                     <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white">Facebook</a>
                        <a href="#" class="text-gray-400 hover:text-white">Zalo</a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-5 text-center text-sm text-gray-500">
                <p>&copy; 2025 Äá»“ng NhÃ¢n Food. All Rights Reserved.<a href="#" class="hover:text-white mt-2 inline-block">TuyÃªn bá»‘ quyá»n riÃªng tÆ°</a></p>
            </div>
        </div>
    </footer>

    <!-- MODALS -->
    <div id="paymentOptionsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"></div>
    <div id="bankingPaymentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"></div>
    <div id="debtWarningModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"></div>
</body>

<script>
// --- STATE MANAGEMENT ---
let cart = [];
let currentUser = null;
let isLoggedIn = false;
let orderHistory = [];
let currentCategory = 'all';
let discountPercent = 0;
let demoUsers = [
    { id: 1, name: 'Nguyá»…n VÄƒn A', email: 'demo@example.com', phone: '0901234567', password: '123456', debt: 150000, creditLimit: 200000, address: "123 ÄÆ°á»ng ABC, VÅ©ng TÃ u" }
];
const discountCodes = { 'DONGNHAN10': 10, 'DEAL20': 20 };

// --- TEMPLATES ---
const TEMPLATES = {
    intro: `
        <div class="bg-emerald-600 text-white rounded-2xl p-6 md:p-8 mb-10 card-shadow">
            <div class="text-center relative z-10">
                <h1 class="text-3xl md:text-5xl font-bold mb-3">BÃ¡nh MÃ¬ Ngon - Gáº¯n Káº¿t Cá»™ng Äá»“ng</h1>
                <p class="text-md md:text-xl mb-6 text-emerald-100">Sáº£n pháº©m cháº¥t lÆ°á»£ng tá»« Äá»“ng NhÃ¢n Food</p>
                <div class="flex flex-col sm:flex-row gap-3 justify-center items-center">
                    <div class="flex items-center space-x-2 bg-white bg-opacity-20 px-4 py-2 rounded-full">
                        <span class="text-xl">ğŸ“</span><span class="font-semibold">Hotline: 0934.945.967</span>
                    </div>
                    <button onclick="showSection('menu')" class="bg-white text-emerald-600 px-6 py-2 rounded-full font-semibold hover:bg-emerald-50">Xem Sáº£n Pháº©m Ngay</button>
                </div>
            </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12 text-center">
            <div class="bg-white p-4 rounded-lg interactive-card"><div class="text-3xl mb-2">ğŸŒ¿</div><h3 class="text-lg font-bold mb-1">NguyÃªn Liá»‡u Sáº¡ch</h3><p class="text-gray-600 text-sm">Nguá»“n nguyÃªn liá»‡u Ä‘Æ°á»£c chá»n lá»c ká»¹ lÆ°á»¡ng, Ä‘áº£m báº£o an toÃ n vÃ  tÆ°Æ¡i ngon.</p></div>
            <div class="bg-white p-4 rounded-lg interactive-card"><div class="text-3xl mb-2">ğŸ›¡ï¸</div><h3 class="text-lg font-bold mb-1">An ToÃ n Vá»‡ Sinh</h3><p class="text-gray-600 text-sm">Quy trÃ¬nh sáº£n xuáº¥t hiá»‡n Ä‘áº¡i, Ä‘áº¡t chuáº©n an toÃ n vá»‡ sinh thá»±c pháº©m.</p></div>
            <div class="bg-white p-4 rounded-lg interactive-card"><div class="text-3xl mb-2">ğŸšš</div><h3 class="text-lg font-bold mb-1">Tiá»‡n Lá»£i & Nhanh ChÃ³ng</h3><p class="text-gray-600 text-sm">Há»‡ thá»‘ng phÃ¢n phá»‘i rá»™ng kháº¯p, mang sáº£n pháº©m Ä‘áº¿n tay báº¡n nhanh nháº¥t.</p></div>
        </div>
                <div class="bg-white rounded-lg card-shadow p-6 md:p-10 mb-12">
            <h2 class="text-2xl font-bold text-center text-emerald-800 mb-6">Sáº£n Pháº©m Ná»•i Báº­t</h2>
            <div id="featuredProductsGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
            <div class="text-center mt-6"><button onclick="showSection('menu')" class="bg-emerald-600 text-white px-6 py-2.5 rounded-full font-semibold hover:bg-emerald-700">Xem Táº¥t Cáº£ Sáº£n Pháº©m</button></div>
        </div>
        <div class="bg-white rounded-lg card-shadow p-6 md:p-10 mb-12 grid md:grid-cols-2 gap-8 items-center">
            <div>
                <h2 class="text-2xl font-bold text-emerald-800 mb-4">Vá» Äá»“ng NhÃ¢n Food</h2>
                <div class="text-gray-700 space-y-3">
                    <p>Vá»›i kinh nghiá»‡m lÃ¢u nÄƒm, Äá»“ng NhÃ¢n Food tá»± hÃ o mang Ä‘áº¿n nhá»¯ng sáº£n pháº©m khÃ´ng chá»‰ ngon miá»‡ng mÃ  cÃ²n Ä‘áº£m báº£o an toÃ n tuyá»‡t Ä‘á»‘i cho sá»©c khá»e. ChÃºng tÃ´i chuyÃªn:</p>
                    <ul class="space-y-2 list-inside list-disc marker:text-emerald-500">
                        <li>Cung cáº¥p Cháº£ CÃ¡ Sá»£i, Cháº£ CÃ¡ TÆ°Æ¡i, Cháº£ CÃ¡ Chá»£, Cháº£ CÃ¡ Nha Trang cháº¥t lÆ°á»£ng cao.</li>
                        <li>HÆ°á»›ng dáº«n khá»Ÿi nghiá»‡p mÃ´ hÃ¬nh kinh doanh bÃ¡nh mÃ¬ cháº£ cÃ¡ thÃ nh cÃ´ng.</li>
                        <li>Cung cáº¥p vÃ  cho thuÃª xe bÃ¡nh mÃ¬, há»— trá»£ Ä‘á»‘i tÃ¡c tá»‘i Ä‘a.</li>
                    </ul>
                </div>
            </div>
            <div class="aspect-w-16 aspect-h-9 rounded-lg overflow-hidden shadow-lg">
                 <iframe class="w-full h-full" src="https://www.youtube.com/embed/5kSmizoku8s" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>


        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center mb-12">
            <div class="bg-white rounded-lg card-shadow p-6 interactive-card">
                 <h2 class="text-2xl font-bold text-emerald-800 mb-4">Dá»‹ch Vá»¥ Cá»§a ChÃºng TÃ´i</h2>
                <div class="space-y-4">
                    <div><h3 class="text-lg font-semibold mb-1">ğŸ“¦ Cung cáº¥p Sá»‰ & Láº»</h3><p class="text-gray-600 text-sm">Cung cáº¥p sáº£n pháº©m cháº¥t lÆ°á»£ng cho Ä‘á»‘i tÃ¡c nhÃ  hÃ ng, quÃ¡n Äƒn vÃ  khÃ¡ch hÃ ng cÃ¡ nhÃ¢n vá»›i giÃ¡ cáº£ cáº¡nh tranh.</p></div>
                    <div><h3 class="text-lg font-semibold mb-1">ğŸ¤ NhÆ°á»£ng Quyá»n Kinh Doanh</h3><p class="text-gray-600 text-sm">MÃ´ hÃ¬nh kinh doanh thÃ nh cÃ´ng. Cung cáº¥p gÃ³i nhÆ°á»£ng quyá»n toÃ n diá»‡n: Ä‘Ã o táº¡o, nguyÃªn liá»‡u, há»— trá»£ marketing.</p><button onclick="handleFranchiseClick()" class="mt-3 bg-amber-400 text-slate-800 px-5 py-2 rounded-lg hover:bg-amber-300 font-semibold text-sm">ÄÄƒng kÃ½ ngay</button></div>
                </div>
            </div>
            <div class="text-center"><img src="https://raw.githubusercontent.com/HienNguyenEMS/chacavungtau/refs/heads/main/logo.jpg" alt="Äá»“ng NhÃ¢n Food" class="rounded-lg shadow-lg mx-auto max-w-sm w-full"></div>
        </div>
        
        <div class="gradient-bg text-white rounded-lg p-6 text-center"><h2 class="text-2xl font-bold mb-3">Sáºµn sÃ ng thÆ°á»Ÿng thá»©c sáº£n pháº©m cháº¥t lÆ°á»£ng?</h2><button onclick="showSection('menu')" class="bg-white text-emerald-600 px-6 py-2.5 rounded-full font-semibold hover:bg-emerald-50 mt-2">Äáº·t HÃ ng Ngay</button></div>`,
    menu: `<h2 class="text-3xl font-bold text-emerald-800 mb-8 text-center">Sáº£n Pháº©m Cá»§a ChÃºng TÃ´i</h2>
           <div id="category-filters" class="flex flex-wrap justify-center gap-2 md:gap-4 mb-8">
               <button onclick="filterProducts('all', this)" class="category-btn active px-4 py-2 text-sm md:text-base md:px-6 rounded-full">Táº¥t cáº£</button>
               <button onclick="filterProducts('banhmi', this)" class="category-btn bg-white border px-4 py-2 text-sm md:text-base md:px-6 rounded-full">BÃ¡nh MÃ¬</button>
               <button onclick="filterProducts('chaca', this)" class="category-btn bg-white border px-4 py-2 text-sm md:text-base md:px-6 rounded-full">Cháº£ CÃ¡</button>
               <button onclick="filterProducts('combo', this)" class="category-btn bg-white border px-4 py-2 text-sm md:text-base md:px-6 rounded-full">Combo</button>
           </div>
           <div id="productGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8"></div>`,
    stores: `<h2 class="text-3xl font-bold text-emerald-800 mb-8 text-center">Há»‡ Thá»‘ng Cá»­a HÃ ng</h2><div id="storeGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>`,
    cart: `<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Giá» HÃ ng Cá»§a Báº¡n</h2><div class="max-w-4xl mx-auto"><div id="cartItems" class="space-y-4"></div><div id="cartSummary" class="mt-6"></div><div id="cartActions" class="mt-8 text-center hidden"><button onclick="proceedToOrder()" class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 text-lg font-semibold">Tiáº¿n hÃ nh thanh toÃ¡n ğŸ›’</button></div></div>`,
    login: `<div class="max-w-md mx-auto bg-white rounded-lg card-shadow p-8"><h2 class="text-3xl font-bold text-center mb-8">ÄÄƒng Nháº­p</h2><form id="loginForm"><div class="space-y-4"><input type="text" id="loginIdentifier" required placeholder="Email hoáº·c SÄT" class="w-full px-4 py-3 border rounded-lg"><input type="password" id="loginPassword" required placeholder="Máº­t kháº©u" class="w-full px-4 py-3 border rounded-lg"><button type="submit" class="w-full bg-emerald-600 text-white py-3 rounded-lg font-semibold">ÄÄƒng nháº­p</button></div></form><div id="loginMessage" class="mt-4 text-center text-sm"></div><p class="mt-6 text-center">ChÆ°a cÃ³ tÃ i khoáº£n? <button onclick="showSection('register')" class="text-emerald-600 font-medium">ÄÄƒng kÃ½</button></p></div>`,
    register: `<div class="max-w-md mx-auto bg-white rounded-lg card-shadow p-8"><h2 class="text-3xl font-bold text-center mb-8">ÄÄƒng KÃ½ TÃ i Khoáº£n</h2><form id="registerForm"><div class="space-y-4"><input type="text" id="registerName" required placeholder="Há» vÃ  tÃªn" class="w-full px-4 py-3 border rounded-lg"><input type="tel" id="registerPhone" required placeholder="Sá»‘ Ä‘iá»‡n thoáº¡i" class="w-full px-4 py-3 border rounded-lg"><input type="email" id="registerEmail" required placeholder="Email" class="w-full px-4 py-3 border rounded-lg"><input type="password" id="registerPassword" required minlength="6" placeholder="Máº­t kháº©u (Ã­t nháº¥t 6 kÃ½ tá»±)" class="w-full px-4 py-3 border rounded-lg"><button type="submit" class="w-full bg-emerald-600 text-white py-3 rounded-lg font-semibold">Táº¡o tÃ i khoáº£n</button></div></form><div id="registerMessage" class="mt-4 text-center text-sm"></div><p class="mt-6 text-center">ÄÃ£ cÃ³ tÃ i khoáº£n? <button onclick="showSection('login')" class="text-emerald-600 font-medium">ÄÄƒng nháº­p</button></p></div>`,
    dashboard: `<div class="max-w-6xl mx-auto"><div class="flex items-center justify-between mb-4"><h2 class="text-3xl font-bold">Dashboard</h2></div><div class="bg-white rounded-lg card-shadow"><div class="flex flex-wrap border-b"><button onclick="showDashboardTab('overview', this)" class="dashboard-tab active px-6 py-3 font-medium">Tá»•ng quan</button><button onclick="showDashboardTab('orders', this)" class="dashboard-tab px-6 py-3 font-medium">ÄÆ¡n hÃ ng</button><button onclick="showDashboardTab('debt', this)" class="dashboard-tab px-6 py-3 font-medium">CÃ´ng ná»£</button><button onclick="showDashboardTab('profile', this)" class="dashboard-tab px-6 py-3 font-medium">TÃ i khoáº£n</button></div><div class="p-6"><div id="overviewTab" class="dashboard-content animate-fade-in"></div><div id="ordersTab" class="dashboard-content hidden animate-fade-in"></div><div id="debtTab" class="dashboard-content hidden animate-fade-in"></div><div id="profileTab" class="dashboard-content hidden animate-fade-in"></div></div></div></div>`,
    franchise: `<div class="max-w-3xl mx-auto bg-white rounded-lg card-shadow p-8"><h2 class="text-3xl font-bold text-center mb-2">ÄÄƒng KÃ½ NhÆ°á»£ng Quyá»n & Äáº¡i LÃ½</h2><p class="text-center text-gray-600 mb-8">CÃ¹ng Äá»“ng NhÃ¢n Food lan tá»a sáº£n pháº©m cháº¥t lÆ°á»£ng</p><div class="grid md:grid-cols-2 gap-8"><form id="franchiseForm"><h3 class="text-xl font-semibold mb-4">ThÃ´ng tin Ä‘Äƒng kÃ½</h3><div class="space-y-4"><input type="text" id="franchiseName" required placeholder="Há» vÃ  tÃªn" class="w-full px-4 py-2 border rounded-lg bg-gray-100"><input type="tel" id="franchisePhone" required placeholder="Sá»‘ Ä‘iá»‡n thoáº¡i" class="w-full px-4 py-2 border rounded-lg bg-gray-100"><input type="email" id="franchiseEmail" required placeholder="Email" class="w-full px-4 py-2 border rounded-lg bg-gray-100"><input type="text" id="franchiseArea" required placeholder="Khu vá»±c muá»‘n kinh doanh" class="w-full px-4 py-2 border rounded-lg"><textarea id="franchiseMessage" placeholder="Lá»i nháº¯n hoáº·c cÃ¢u há»i thÃªm..." rows="3" class="w-full px-4 py-2 border rounded-lg"></textarea><div class="flex items-start"><input type="checkbox" id="franchiseTerms" required class="mt-1 mr-2"><label for="franchiseTerms" class="text-sm text-gray-600">TÃ´i Ä‘Ã£ Ä‘á»c vÃ  Ä‘á»“ng Ã½ vá»›i <a href="#" class="text-emerald-600">cÃ¡c Ä‘iá»u khoáº£n nhÆ°á»£ng quyá»n</a>.</label></div><button type="submit" class="w-full bg-amber-400 text-slate-800 py-3 rounded-lg font-semibold hover:bg-amber-300">Gá»­i YÃªu Cáº§u</button></div></form><div><h3 class="text-xl font-semibold mb-4">Quy trÃ¬nh & HÆ°á»›ng dáº«n</h3><ul class="list-disc list-inside space-y-3 text-gray-700"><li><strong>BÆ°á»›c 1:</strong> Äiá»n vÃ  gá»­i thÃ´ng tin cá»§a báº¡n qua form bÃªn cáº¡nh.</li><li><strong>BÆ°á»›c 2:</strong> Äá»™i ngÅ© cá»§a chÃºng tÃ´i sáº½ liÃªn há»‡ láº¡i trong vÃ²ng 24 giá» Ä‘á»ƒ tÆ° váº¥n chi tiáº¿t.</li><li><strong>BÆ°á»›c 3:</strong> Trao Ä‘á»•i, thá»‘ng nháº¥t cÃ¡c Ä‘iá»u khoáº£n vÃ  kÃ½ káº¿t há»£p Ä‘á»“ng.</li><li><strong>BÆ°á»›c 4:</strong> ChÃºng tÃ´i sáº½ há»— trá»£ báº¡n chuáº©n bá»‹ máº·t báº±ng, Ä‘Ã o táº¡o vÃ  báº¯t Ä‘áº§u kinh doanh.</li></ul></div></div></div>`,
    paymentOptionsModal: `<div class="bg-white rounded-lg p-6 max-w-lg w-full animate-fade-in"><h3 class="text-2xl font-bold text-center mb-4">XÃ¡c Nháº­n Thanh ToÃ¡n</h3><div id="orderSummaryInModal" class="bg-emerald-50 p-4 rounded-lg mb-6 border text-sm space-y-2"></div><div class="space-y-4"><button onclick="selectPaymentMethod('banking')" class="w-full bg-emerald-600 text-white py-3 rounded-lg flex items-center justify-center space-x-2"><span>ğŸ’³</span><span>Thanh toÃ¡n Banking</span></button><button onclick="selectPaymentMethod('debt')" class="w-full bg-amber-500 text-white py-3 rounded-lg flex items-center justify-center space-x-2"><span>ğŸ“‹</span><span>Ghi cÃ´ng ná»£</span></button></div><button onclick="closeModal('paymentOptionsModal')" class="w-full mt-6 bg-gray-300 py-2 rounded-lg">Há»§y</button></div>`,
    bankingPaymentModal: `<div class="bg-white rounded-lg p-6 max-w-md w-full animate-fade-in"><h3 class="text-2xl font-bold mb-4 text-center">Thanh toÃ¡n VietQR</h3><img id="bankingQrImage" src="" alt="VietQR Code" class="w-64 h-64 mx-auto bg-gray-100 rounded-lg border"><div class="my-4 text-sm bg-gray-50 p-3 rounded-lg"><p><strong>Sá»‘ tiá»n:</strong> <span id="bankingAmount" class="text-emerald-700 font-bold"></span></p><p><strong>Ná»™i dung:</strong> <span id="bankingContent" class="text-emerald-700"></span></p></div><button onclick="confirmBankingPayment()" class="w-full bg-green-600 text-white py-3 rounded-lg">TÃ´i Ä‘Ã£ thanh toÃ¡n</button><button onclick="closeModal('bankingPaymentModal')" class="w-full mt-3 bg-gray-300 py-2 rounded-lg">ÄÃ³ng</button></div>`,
    debtWarningModal: `<div class="bg-white rounded-lg p-6 max-w-lg w-full animate-fade-in"><h3 class="text-2xl font-bold text-red-600 text-center mb-4">âš ï¸ VÆ°á»£t Háº¡n Má»©c CÃ´ng Ná»£</h3><div id="debtWarningContent" class="bg-red-50 p-4 rounded-lg border border-red-200 mb-4 text-sm space-y-2"></div><p class="text-center mb-4">Vui lÃ²ng thanh toÃ¡n cÃ´ng ná»£ cÅ© Ä‘á»ƒ tiáº¿p tá»¥c.</p><img id="debtQrImage" src="" alt="VietQR for Debt" class="w-56 h-56 mx-auto bg-gray-100 rounded-lg border"><button onclick="confirmDebtPayment()" class="w-full mt-4 bg-green-600 text-white py-3 rounded-lg">TÃ´i Ä‘Ã£ thanh toÃ¡n cÃ´ng ná»£</button><button onclick="closeModal('debtWarningModal')" class="w-full mt-3 bg-gray-300 py-2 rounded-lg">ÄÃ³ng</button></div>`
};

// --- UI & NAVIGATION ---
function showSection(sectionName) {
    document.querySelectorAll('main > section').forEach(sec => sec.classList.add('hidden'));
    const sectionEl = document.getElementById(sectionName + 'Section');
    if (sectionEl) {
        sectionEl.innerHTML = TEMPLATES[sectionName] || '';
        sectionEl.classList.remove('hidden');
    }
    updateMobileNavigation(sectionName);
    window.scrollTo(0, 0);

    if (sectionName.match(/login|register/)) document.getElementById(`${sectionName}Form`).addEventListener('submit', sectionName === 'login' ? handleLogin : handleRegister);
    if (sectionName === 'intro') loadFeaturedProducts();
    if (sectionName === 'menu') filterProducts(currentCategory, document.querySelector('.category-btn.active'));
    if (sectionName === 'stores') loadStores();
    if (sectionName === 'cart') updateCartDisplay();
    if (sectionName === 'dashboard') loadDashboard();
    if (sectionName === 'franchise') {
       
        document.getElementById('franchiseForm').addEventListener('submit', handleFranchiseSubmit);
        prefillFranchiseForm();
    }
}

function updateMobileNavigation(activeSection) {
    document.querySelectorAll('.mobile-nav-btn').forEach(btn => btn.classList.toggle('active', btn.getAttribute('data-section') === activeSection));
}

function updateMenuVisibility() {
    const hasItems = cart.length > 0;
    document.getElementById('navCart').classList.toggle('hidden', !hasItems);
    const mobileNavCart = document.getElementById('mobileNavCart');
    mobileNavCart.classList.toggle('hidden', !hasItems);
    mobileNavCart.classList.toggle('flex', hasItems);
    
    const mobileNavGrid = document.getElementById('mobileNavGrid');
    let visibleItems = 2 + (hasItems ? 1 : 0) + 1; // home, products, account + cart if exists
    mobileNavGrid.style.gridTemplateColumns = `repeat(${visibleItems}, 1fr)`;
}

function closeModal(modalId) { 
    const modal = document.getElementById(modalId);
    if(modal) { modal.innerHTML = ''; modal.classList.add('hidden'); }
}

// --- CONTENT LOADING ---
function loadFeaturedProducts() {
    const grid = document.getElementById('featuredProductsGrid');
    if(grid) grid.innerHTML = products.slice(0, 3).map(p => `<div class="bg-gray-50 rounded-lg p-4 text-center interactive-card"><div class="h-40 bg-gray-200 flex items-center justify-center rounded-lg">${p.image}</div><h4 class="font-bold mt-4">${p.name}</h4><p class="text-emerald-600 font-semibold">${p.price.toLocaleString()}Ä‘</p></div>`).join('');
}

function filterProducts(category, element) {
    currentCategory = category;
    document.querySelectorAll('#category-filters .category-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.classList.add('bg-white', 'border');
    });
    element.classList.add('active');
    element.classList.remove('bg-white', 'border');
    loadProducts();
}

function loadProducts() {
    const grid = document.getElementById('productGrid');
    if(!grid) return;
    const productsToDisplay = currentCategory === 'all' ? products : products.filter(p => p.category === currentCategory);

    grid.innerHTML = productsToDisplay.map(p => {
        const cartItem = cart.find(item => item.id === p.id);
        const quantity = cartItem ? cartItem.quantity : 0;
        
        const buttonHtml = quantity > 0
            ? `<div class="flex items-center justify-center gap-4">
                 <button onclick="updateCartQuantity(${p.id}, -1)" class="w-10 h-10 bg-gray-200 rounded-full font-bold text-lg">-</button>
                 <span class="text-xl font-semibold">${quantity}</span>
                 <button onclick="updateCartQuantity(${p.id}, 1)" class="w-10 h-10 bg-gray-200 rounded-full font-bold text-lg">+</button>
               </div>`
            : `<button onclick="addToCart(${p.id})" class="w-full text-white py-2 rounded-lg font-semibold bg-emerald-600 hover:bg-emerald-700">ThÃªm vÃ o giá» hÃ ng ğŸ›’</button>`;
            
        return `<div class="bg-white rounded-lg card-shadow overflow-hidden interactive-card"><div class="h-48 bg-gray-100 flex items-center justify-center">${p.image}</div><div class="p-4"><h3 class="font-bold text-lg">${p.name}</h3><p class="text-gray-600 text-sm h-10">${p.description}</p><div class="flex items-center justify-between mt-2 mb-4"><span class="text-xl font-bold text-emerald-600">${p.price.toLocaleString()}Ä‘</span></div><div id="product-actions-${p.id}">${buttonHtml}</div></div></div>`;
    }).join('');
}


function loadStores() {
    const grid = document.getElementById('storeGrid');
    if(grid) grid.innerHTML = branches.map(b => `<div class="bg-white rounded-lg card-shadow p-6 border-l-4 border-amber-500 interactive-card"><h3 class="font-bold text-lg">${b.emoji} ${b.name}</h3><p class="text-sm text-gray-600 mt-2">ğŸ“ ${b.address}</p><p class="text-sm text-gray-600 mt-1">ğŸ“ ${b.phone}</p></div>`).join('');
}

// --- CART LOGIC ---
function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    cart.push({ ...product, quantity: 1 });
    showNotification(`${product.name} Ä‘Ã£ Ä‘Æ°á»£c thÃªm vÃ o giá».`);
    updateAllUI();
}

function updateCartQuantity(productId, change) {
    const item = cart.find(item => item.id === productId);
    if (!item) { // If item not in cart, add it (case from product page)
        if(change > 0) addToCart(productId);
        return;
    }
    item.quantity += change;
    if (item.quantity <= 0) {
        cart = cart.filter(i => i.id !== productId);
    }
    updateAllUI();
}

function removeFromCart(productId) {
    cart = cart.filter(item => item.id !== productId);
    updateAllUI();
}

function updateCartDisplay() {
    const itemsEl = document.getElementById('cartItems');
    const summaryEl = document.getElementById('cartSummary');
    const actionsEl = document.getElementById('cartActions');
    if(!itemsEl) return;
    if (cart.length === 0) {
        itemsEl.innerHTML = `<div class="text-center py-12"><h3 class="text-xl text-gray-600">Giá» hÃ ng cá»§a báº¡n Ä‘ang trá»‘ng.</h3><button onclick="showSection('menu')" class="mt-4 bg-emerald-600 text-white px-6 py-2 rounded-lg">Mua sáº¯m ngay</button></div>`;
        summaryEl.innerHTML = '';
        actionsEl.classList.add('hidden');
    } else {
        itemsEl.innerHTML = cart.map(item => `<div class="bg-white rounded-lg card-shadow p-4 flex items-center gap-4"><div class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">${item.image}</div><div class="flex-1"><h3 class="font-semibold">${item.name}</h3><p class="text-emerald-600">${item.price.toLocaleString()}Ä‘</p></div><div class="flex items-center gap-3"><button onclick="updateCartQuantity(${item.id}, -1)" class="w-8 h-8 bg-gray-200 rounded-full font-bold">-</button><span class="text-lg font-semibold">${item.quantity}</span><button onclick="updateCartQuantity(${item.id}, 1)" class="w-8 h-8 bg-gray-200 rounded-full font-bold">+</button></div><p class="font-bold text-lg w-24 text-right">${(item.price * item.quantity).toLocaleString()}Ä‘</p><button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 p-2">âœ–</button></div>`).join('');
        
        const subtotal = cart.reduce((s, i) => s + i.price * i.quantity, 0);
        const discountAmount = subtotal * (discountPercent / 100);
        const total = subtotal - discountAmount;

        summaryEl.innerHTML = `
            <div class="max-w-sm ml-auto bg-white p-6 rounded-lg card-shadow">
                <div class="flex justify-between items-center mb-4">
                    <input type="text" id="discountCodeInput" placeholder="Nháº­p mÃ£ giáº£m giÃ¡" class="w-full px-3 py-2 border rounded-l-lg">
                    <button onclick="applyDiscount()" class="bg-gray-600 text-white px-4 py-2 rounded-r-lg hover:bg-gray-700">Ãp dá»¥ng</button>
                </div>
                <div id="discountMessage" class="text-sm mb-4"></div>
                <div class="space-y-2 border-t pt-4">
                    <div class="flex justify-between"><span class="text-gray-600">Táº¡m tÃ­nh:</span><span>${subtotal.toLocaleString()}Ä‘</span></div>
                    ${discountPercent > 0 ? `<div class="flex justify-between text-green-600"><span class="text-gray-600">Giáº£m giÃ¡ (${discountPercent}%):</span><span>-${discountAmount.toLocaleString()}Ä‘</span></div>` : ''}
                    <div class="flex justify-between text-xl font-bold"><span class="text-gray-800">Tá»•ng cá»™ng:</span><span class="text-emerald-600">${total.toLocaleString()}Ä‘</span></div>
                </div>
            </div>
        `;

        actionsEl.classList.remove('hidden');
    }
}

function applyDiscount() {
    const code = document.getElementById('discountCodeInput').value.toUpperCase();
    const messageEl = document.getElementById('discountMessage');
    if (discountCodes[code]) {
        discountPercent = discountCodes[code];
        messageEl.innerHTML = `<p class="text-green-600">Ãp dá»¥ng mÃ£ thÃ nh cÃ´ng! Báº¡n Ä‘Æ°á»£c giáº£m ${discountPercent}%.</p>`;
    } else {
        discountPercent = 0;
        messageEl.innerHTML = `<p class="text-red-500">MÃ£ giáº£m giÃ¡ khÃ´ng há»£p lá»‡.</p>`;
    }
    updateCartDisplay();
}

// --- PAYMENT & FRANCHISE FLOW ---
function proceedToOrder() {
    if (!isLoggedIn) { showNotification("Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ thanh toÃ¡n.", true); showSection('login'); return; }
    
    const subtotal = cart.reduce((s, i) => s + i.price * i.quantity, 0);
    const discountAmount = subtotal * (discountPercent / 100);
    const orderTotal = subtotal - discountAmount;
    const debt = currentUser.debt || 0;
    const finalTotal = orderTotal + debt;

    const modal = document.getElementById('paymentOptionsModal');
    modal.innerHTML = TEMPLATES.paymentOptionsModal;
    
    document.getElementById('orderSummaryInModal').innerHTML = `
        <div class="flex justify-between"><span>Tá»•ng Ä‘Æ¡n hÃ ng má»›i:</span><strong>${orderTotal.toLocaleString()}Ä‘</strong></div>
        ${discountPercent > 0 ? `<div class="flex justify-between text-green-600"><span>(ÄÃ£ giáº£m ${discountAmount.toLocaleString()}Ä‘)</span></div>` : ''}
        <div class="flex justify-between"><span>CÃ´ng ná»£ cÅ©:</span><strong>${debt.toLocaleString()}Ä‘</strong></div>
        <hr class="my-2">
        <div class="flex justify-between font-bold text-lg"><span class="text-gray-800">Tá»•ng thanh toÃ¡n:</span><strong class="text-emerald-600">${finalTotal.toLocaleString()}Ä‘</strong></div>
    `;
    modal.classList.remove('hidden');
}

function selectPaymentMethod(method) {
    closeModal('paymentOptionsModal');
    method === 'banking' ? showBankingPayment() : checkDebtLimitAndProcess();
}

function generateVietQRUrl(amount, content) {
    const accountInfo = { bank: "970422", acc: "0934945967", name: "NGUYEN CHI THANH" };
    return `https://api.vietqr.io/v2/generate?accountNo=${accountInfo.acc}&accountName=${encodeURIComponent(accountInfo.name)}&acqId=${accountInfo.bank}&amount=${amount}&addInfo=${encodeURIComponent(content)}&template=compact2`;
}

function showBankingPayment() {
    const modal = document.getElementById('bankingPaymentModal');
    modal.innerHTML = TEMPLATES.bankingPaymentModal;
    const orderTotal = cart.reduce((s, i) => s + i.price * i.quantity, 0) * (1 - discountPercent / 100);
    const totalToPay = orderTotal + (currentUser.debt || 0);
    const orderId = 'DH' + Date.now().toString().slice(-6);
    const qrContent = `TT ${orderId}`;
    document.getElementById('bankingQrImage').src = generateVietQRUrl(totalToPay, qrContent);
    document.getElementById('bankingAmount').textContent = `${totalToPay.toLocaleString()}Ä‘`;
    document.getElementById('bankingContent').textContent = qrContent;
    modal.classList.remove('hidden');
}

function confirmBankingPayment() {
    const total = cart.reduce((s, i) => s + i.price * i.quantity, 0) * (1 - discountPercent / 100);
    orderHistory.push({ id: orderHistory.length + 1, code: 'DH' + Date.now().toString().slice(-6), status: 'Äang xá»­ lÃ½', total: total, date: new Date() });
    currentUser.debt = 0; // Assume all debt is paid
    cart = [];
    discountPercent = 0;
    closeModal('bankingPaymentModal');
    showNotification("Thanh toÃ¡n thÃ nh cÃ´ng! ÄÆ¡n hÃ ng Ä‘ang Ä‘Æ°á»£c xá»­ lÃ½.");
    updateAllUI();
    showSection('dashboard');
}

function checkDebtLimitAndProcess() {
    const orderTotal = cart.reduce((s, i) => s + i.price * i.quantity, 0) * (1 - discountPercent / 100);
    const newDebtTotal = (currentUser.debt || 0) + orderTotal;
    if (newDebtTotal > currentUser.creditLimit) {
        showDebtWarning(currentUser.debt, orderTotal, currentUser.creditLimit);
    } else {
        currentUser.debt = newDebtTotal;
        orderHistory.push({ id: orderHistory.length + 1, code: 'DH' + Date.now().toString().slice(-6), status: 'Äang xá»­ lÃ½ (CÃ´ng ná»£)', total: orderTotal, date: new Date() });
        cart = [];
        discountPercent = 0;
        showNotification("Äáº·t hÃ ng cÃ´ng ná»£ thÃ nh cÃ´ng!");
        updateAllUI();
        showSection('dashboard');
    }
}

function showDebtWarning(currentDebt, orderTotal, creditLimit) {
    const modal = document.getElementById('debtWarningModal');
    modal.innerHTML = TEMPLATES.debtWarningModal;
    document.getElementById('debtWarningContent').innerHTML = `<p>CÃ´ng ná»£ hiá»‡n táº¡i: <strong class="text-red-600">${currentDebt.toLocaleString()}Ä‘</strong></p><p>ÄÆ¡n hÃ ng má»›i: <strong>${orderTotal.toLocaleString()}Ä‘</strong></p><p>Tá»•ng cÃ´ng ná»£ má»›i sáº½ lÃ  <strong class="text-red-600">${(currentDebt + orderTotal).toLocaleString()}Ä‘</strong>, vÆ°á»£t quÃ¡ háº¡n má»©c <strong>${creditLimit.toLocaleString()}Ä‘</strong>.</p>`;
    document.getElementById('debtQrImage').src = generateVietQRUrl(currentDebt, `TT Cong No ${currentUser.phone}`);
    modal.classList.remove('hidden');
}

function confirmDebtPayment() {
    showNotification("Thanh toÃ¡n cÃ´ng ná»£ thÃ nh cÃ´ng! Vui lÃ²ng Ä‘áº·t láº¡i Ä‘Æ¡n hÃ ng.");
    currentUser.debt = 0;
    closeModal('debtWarningModal');
    updateAllUI();
}

function handleFranchiseClick() {
    if (isLoggedIn) showSection('franchise');
    else { showNotification("Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ Ä‘Äƒng kÃ½.", true); showSection('login'); }
}

function prefillFranchiseForm() {
    if(isLoggedIn) {
        document.getElementById('franchiseName').value = currentUser.name;
        document.getElementById('franchisePhone').value = currentUser.phone;
        document.getElementById('franchiseEmail').value = currentUser.email;
    }
}

function handleFranchiseSubmit(event) {
    event.preventDefault();
    if (!document.getElementById('franchiseTerms').checked) {
        showNotification("Báº¡n pháº£i Ä‘á»“ng Ã½ vá»›i Ä‘iá»u khoáº£n Ä‘á»ƒ tiáº¿p tá»¥c.", true); return;
    }
    showNotification("YÃªu cáº§u cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c gá»­i. ChÃºng tÃ´i sáº½ liÃªn há»‡ láº¡i sá»›m!");
    setTimeout(() => showSection('intro'), 2000);
}

// --- LOGIN & REGISTER & USER ---
function handleLogin(event) {
    event.preventDefault();
    const id = document.getElementById('loginIdentifier').value;
    const pass = document.getElementById('loginPassword').value;
    const user = demoUsers.find(u => (u.email === id || u.phone === id) && u.password === pass);
    if (user) {
        currentUser = user;
        isLoggedIn = true;
        showNotification(`ChÃ o má»«ng, ${currentUser.name}!`);
        updateAllUI();
        showSection('intro');
    } else {
        document.getElementById('loginMessage').innerHTML = `<p class="text-red-500">ThÃ´ng tin khÃ´ng chÃ­nh xÃ¡c.</p>`;
    }
}

function logout() {
    currentUser = null;
    isLoggedIn = false;
    showNotification('ÄÃ£ Ä‘Äƒng xuáº¥t!');
    updateAllUI();
    showSection('intro');
}

function handleRegister(event) {
    event.preventDefault();
    const [name, phone, email, pass] = ['registerName', 'registerPhone', 'registerEmail', 'registerPassword'].map(id => document.getElementById(id).value);
    const msgEl = document.getElementById('registerMessage');
    if (demoUsers.some(u => u.email === email || u.phone === phone)) {
        msgEl.innerHTML = `<p class="text-red-500">Email hoáº·c SÄT Ä‘Ã£ tá»“n táº¡i.</p>`; return;
    }
    const newUser = { id: Date.now(), name, email, phone, password: pass, debt: 0, creditLimit: 200000, address: "" };
    demoUsers.push(newUser);
    msgEl.innerHTML = `<p class="text-green-500">ÄÄƒng kÃ½ thÃ nh cÃ´ng! Äang tá»± Ä‘á»™ng Ä‘Äƒng nháº­p...</p>`;
    setTimeout(() => {
        const user = demoUsers.find(u => u.email === email && u.password === pass);
        if(user) { currentUser = user; isLoggedIn = true; showNotification(`ChÃ o má»«ng, ${currentUser.name}!`); updateAllUI(); showSection('intro'); }
    }, 1500);
}

// --- DASHBOARD ---
function loadDashboard() { showDashboardTab('overview', document.querySelector('#dashboardSection .dashboard-tab')); }

function showDashboardTab(tabName, clickedElement) {
    document.querySelectorAll('.dashboard-content').forEach(el => el.classList.add('hidden'));
    document.getElementById(tabName + 'Tab').classList.remove('hidden');
    document.querySelectorAll('.dashboard-tab').forEach(btn => btn.classList.remove('active'));
    clickedElement.classList.add('active');

    if (tabName === 'overview') loadDashboardOverview();
    if (tabName === 'orders') loadOrders();
    if (tabName === 'debt') loadDebtInfo();
    if (tabName === 'profile') loadProfileInfo();
}

function loadDashboardOverview() {
    const el = document.getElementById('overviewTab');
    const processing = orderHistory.filter(o => o.status.includes('Äang xá»­ lÃ½')).length;
    el.innerHTML = `<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="bg-emerald-50 p-6 rounded-lg"><p class="font-medium text-emerald-600">Tá»•ng Ä‘Æ¡n hÃ ng</p><p class="text-2xl font-bold">${orderHistory.length}</p></div>
        <div class="bg-amber-50 p-6 rounded-lg"><p class="font-medium text-amber-600">Äang xá»­ lÃ½</p><p class="text-2xl font-bold">${processing}</p></div>
        <div class="bg-red-50 p-6 rounded-lg"><p class="font-medium text-red-600">CÃ´ng ná»£</p><p class="text-2xl font-bold">${(currentUser.debt || 0).toLocaleString()}Ä‘</p></div>
    </div>`;
}

function loadOrders() {
    const el = document.getElementById('ordersTab');
    if (orderHistory.length === 0) el.innerHTML = '<p>Báº¡n chÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o.</p>';
    else el.innerHTML = `<h3 class="text-xl font-semibold mb-4">Lá»‹ch sá»­ Ä‘Æ¡n hÃ ng</h3><div class="space-y-4">${orderHistory.map(o => `<div class="bg-gray-50 p-4 rounded-lg shadow-sm"><p><strong>MÃ£ ÄH:</strong> ${o.code}</p><p><strong>NgÃ y:</strong> ${o.date.toLocaleDateString('vi-VN')}</p><p><strong>Tá»•ng tiá»n:</strong> ${o.total.toLocaleString()}Ä‘</p><p><strong>Tráº¡ng thÃ¡i:</strong> <span class="text-orange-500 font-semibold">${o.status}</span></p></div>`).join('')}</div>`;
}

function loadDebtInfo() {
    const el = document.getElementById('debtTab');
    el.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-sm max-w-md"><h3 class="font-bold text-lg mb-4">ThÃ´ng Tin CÃ´ng Ná»£</h3><div class="space-y-2"><p>CÃ´ng ná»£ hiá»‡n táº¡i: <strong class="text-red-500 text-xl">${(currentUser.debt || 0).toLocaleString()}Ä‘</strong></p><p>Háº¡n má»©c tÃ­n dá»¥ng: <strong>${(currentUser.creditLimit || 0).toLocaleString()}Ä‘</strong></p></div><button onclick="showDebtWarning(currentUser.debt, 0)" class="w-full mt-4 bg-red-600 text-white py-2 rounded-lg">Thanh toÃ¡n ngay</button></div>`;
}

function loadProfileInfo() {
    const el = document.getElementById('profileTab');
    el.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-sm max-w-md"><h3 class="font-bold text-lg mb-4">ThÃ´ng Tin TÃ i Khoáº£n</h3><div class="space-y-2"><p><strong>Há» tÃªn:</strong> ${currentUser.name}</p><p><strong>Email:</strong> ${currentUser.email}</p><p><strong>SÄT:</strong> ${currentUser.phone}</p><p><strong>Äá»‹a chá»‰:</strong> ${currentUser.address || "ChÆ°a cáº­p nháº­t"}</p></div></div>`;
}


// --- UTILITY ---
function showNotification(message, isError = false) {
    const el = document.createElement('div');
    const bgColor = isError ? 'bg-red-500' : 'bg-green-500';
    el.className = `fixed top-20 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in`;
    el.textContent = message;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 3000);
}

function updateAllUI() {
    document.querySelectorAll('#cartCount, #mobileCartCount').forEach(el => { el.textContent = cart.reduce((total, item) => total + item.quantity, 0); });
    updateMenuVisibility();
    updateLoginUI();
    const visibleSection = document.querySelector('main > section:not(.hidden)');
    if (visibleSection) {
        const sectionId = visibleSection.id.replace('Section', '');
        if (sectionId === 'menu') loadProducts();
        if (sectionId === 'cart') updateCartDisplay();
    }
}

function updateLoginUI() {
    document.getElementById('notLoggedIn').classList.toggle('hidden', isLoggedIn);
    document.getElementById('loggedIn').classList.toggle('hidden', !isLoggedIn);
    if (isLoggedIn) document.getElementById('userName').textContent = currentUser.name.split(' ').pop();
}

function toggleUserDropdown() { document.getElementById('userDropdownMenu').classList.toggle('show'); }
function closeUserDropdown() { document.getElementById('userDropdownMenu').classList.remove('show'); }

// --- INITIALIZATION ---
document.addEventListener('DOMContentLoaded', () => {
    showSection('intro');
    updateAllUI();
    window.addEventListener('click', (e) => {
        if (!document.querySelector('.dropdown')?.contains(e.target)) closeUserDropdown();
    });
});

// --- DUMMY DATA ---
const products = [
    { id: 1, name: 'BÃ¡nh mÃ¬ cháº£ cÃ¡', price: 20000, category: 'banhmi', description: 'BÃ¡nh mÃ¬ giÃ²n rá»¥m káº¹p cháº£ cÃ¡ nÃ³ng há»•i.', image: '<span class="text-5xl">ğŸ¥–</span>' },
    { id: 2, name: 'Cháº£ cÃ¡ tÆ°Æ¡i (kg)', price: 120000, category: 'chaca', description: 'Cháº£ cÃ¡ tÆ°Æ¡i nguyÃªn cháº¥t, dai ngon.', image: '<span class="text-5xl">ğŸŸ</span>' },
    { id: 3, name: 'Nem nÆ°á»›ng', price: 25000, category: 'banhmi', description: 'Nem nÆ°á»›ng thÆ¡m lá»«ng, Ä‘áº­m Ä‘Ã  hÆ°Æ¡ng vá»‹.', image: '<span class="text-5xl">ğŸ¢</span>' },
    { id: 4, name: 'XÃ´i cháº£ cÃ¡', price: 25000, category: 'combo', description: 'XÃ´i náº¿p dáº»o thÆ¡m Äƒn cÃ¹ng cháº£ cÃ¡.', image: '<span class="text-5xl">ğŸš</span>' },
    { id: 5, name: 'Combo gia Ä‘Ã¬nh', price: 150000, category: 'combo', description: 'Combo tiá»‡n lá»£i cho cáº£ gia Ä‘Ã¬nh.', image: '<span class="text-5xl">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>' },
    { id: 6, name: 'Cháº£ cÃ¡ Nha Trang', price: 150000, category: 'chaca', description: 'Äáº·c sáº£n Nha Trang chÃ­nh gá»‘c.', image: '<span class="text-5xl">ğŸ </span>' }
];
const branches = [
    { id: 'q1', name: 'Chi nhÃ¡nh Quáº­n 1', emoji: 'ğŸ¢', address: '123 ÄÆ°á»ng A, Quáº­n 1, TPHCM', phone: '028.123.4567' },
    { id: 'gv', name: 'Chi nhÃ¡nh GÃ² Váº¥p', emoji: 'ğŸª', address: '456 ÄÆ°á»ng B, Quáº­n GÃ² Váº¥p, TPHCM', phone: '028.234.5678' },
    { id: 'bt', name: 'Chi nhÃ¡nh BÃ¬nh Tháº¡nh', emoji: 'ğŸ˜ï¸', address: '789 ÄÆ°á»ng C, Quáº­n BÃ¬nh Tháº¡nh, TPHCM', phone: '028.456.7890' },
];
</script>
</html>
