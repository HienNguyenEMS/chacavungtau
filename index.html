<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê·ªìng Nh√¢n Food - B√°nh M√¨ & Th·ª±c Ph·∫©m S·∫°ch</title>
    
    <meta name="description" content="ƒê·ªìng Nh√¢n Food chuy√™n cung c·∫•p b√°nh m√¨, ch·∫£ c√° v√† c√°c s·∫£n ph·∫©m th·ª±c ph·∫©m s·∫°ch. Nh·∫≠n ƒë·∫∑t h√†ng online v√† nh∆∞·ª£ng quy·ªÅn kinh doanh.">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%); }
        .card-shadow { box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        .interactive-card {
            transition: all 0.3s ease-in-out;
            border: 2px solid #a7f3d0;
        }
        .interactive-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 20px rgba(16, 185, 129, 0.2);
            border-color: #059669;
        }
        .dropdown { position: relative; }
        .dropdown-menu { 
            position: absolute; top: 100%; right: 0; background: white; 
            border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); 
            min-width: 200px; z-index: 50; transform: translateY(10px) scale(0.95);
            opacity: 0; visibility: hidden; transition: all 0.2s ease; 
        }
        .dropdown-menu.show { transform: translateY(0) scale(1); opacity: 1; visibility: visible; }
        .mobile-nav-btn.active { color: #059669; background-color: #f0fdf4; }
        .dashboard-tab.active { border-bottom-width: 2px; border-color: #059669; color: #059669; }
        .category-btn.active { background-color: #059669; color: white; border-color: #059669; }
        @media (max-width: 768px) {
            main { padding-bottom: 80px; }
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        main > section { padding-top: 2rem; padding-bottom: 2rem; }
        main > section > div { margin-bottom: 2.5rem; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3 cursor-pointer" onclick="showSection('intro')">
                    <img src="https://raw.githubusercontent.com/HienNguyenEMS/chacavungtau/refs/heads/main/logo.jpg" alt="Logo" class="w-10 h-10 rounded-lg">
                    <div><h1 class="text-xl font-bold">ƒê·ªìng Nh√¢n Food</h1></div>
                </div>
                <nav class="hidden md:flex space-x-5 items-center">
                    <button onclick="showSection('intro')" class="hover:text-amber-300 transition-colors">Trang ch·ªß</button>
                    <button onclick="showSection('menu')" class="hover:text-amber-300 transition-colors">S·∫£n ph·∫©m</button>
                    <button onclick="showSection('stores')" class="hover:text-amber-300 transition-colors">C·ª≠a h√†ng</button>
                    <button id="navCart" onclick="showSection('cart')" class="hover:text-amber-300 transition-colors relative hidden">
                        Gi·ªè h√†ng <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                    </button>
                    <div id="userMenuContainer" class="relative">
                        <div id="notLoggedIn" class="flex space-x-3">
                            <button onclick="showSection('login')" class="bg-white bg-opacity-20 px-3 py-1.5 rounded-lg hover:bg-opacity-30">ƒêƒÉng nh·∫≠p</button>
                            <button onclick="showSection('register')" class="bg-amber-400 text-slate-800 px-3 py-1.5 rounded-lg hover:bg-amber-300 font-semibold">ƒêƒÉng k√Ω</button>
                        </div>
                        <div id="loggedIn" class="hidden">
                            <div class="dropdown">
                                <button onclick="toggleUserDropdown()" class="flex items-center space-x-2 bg-white bg-opacity-20 px-3 py-1.5 rounded-lg hover:bg-opacity-30">
                                    <span class="text-xl">üë§</span><span id="userName" class="font-medium"></span>
                                    <svg class="w-4 h-4 transition-transform" id="userDropdownIcon" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                                </button>
                                <div id="userDropdownMenu" class="dropdown-menu">
                                    <button onclick="showSection('dashboard'); closeUserDropdown();" class="w-full text-left px-4 py-2 text-gray-700 hover:bg-emerald-50 flex items-center space-x-2"><span>üìä</span><span>Dashboard</span></button>
                                    <hr class="my-1">
                                    <button onclick="logout(); closeUserDropdown();" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 flex items-center space-x-2"><span>üö™</span><span>ƒêƒÉng xu·∫•t</span></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>
    
    <!-- Mobile Bottom Navigation -->
    <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t z-40">
        <div id="mobileNavGrid" class="grid grid-cols-3 h-16">
            <button onclick="showSection('intro')" class="mobile-nav-btn flex flex-col items-center justify-center space-y-1 text-gray-600" data-section="intro">
                <span class="text-xl">üè†</span><span class="text-xs font-medium">Trang ch·ªß</span>
            </button>
            <button onclick="showSection('menu')" class="mobile-nav-btn flex flex-col items-center justify-center space-y-1 text-gray-600 active" data-section="menu">
                <span class="text-xl">ü•ñ</span><span class="text-xs font-medium">S·∫£n ph·∫©m</span>
            </button>
            <button id="mobileNavCart" onclick="showSection('cart')" class="mobile-nav-btn flex-col items-center justify-center space-y-1 text-gray-600 relative hidden" data-section="cart">
                <span class="text-xl">üõí</span><span class="text-xs font-medium">Gi·ªè h√†ng</span>
                <span id="mobileCartCount" class="absolute top-1 right-4 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
            </button>
             <button onclick="isLoggedIn ? showSection('dashboard') : showSection('login')" class="mobile-nav-btn flex flex-col items-center justify-center space-y-1 text-gray-600" data-section="login">
                <span class="text-xl">üë§</span><span class="text-xs font-medium">T√†i kho·∫£n</span>
            </button>
        </div>
    </div>

    <main class="container mx-auto px-4">
        <section id="introSection" class="hidden animate-fade-in"></section>
        <section id="menuSection" class="animate-fade-in"></section>
        <section id="storesSection" class="hidden animate-fade-in"></section>
        <section id="cartSection" class="hidden animate-fade-in"></section>
        <section id="loginSection" class="hidden animate-fade-in"></section>
        <section id="registerSection" class="hidden animate-fade-in"></section>
        <section id="dashboardSection" class="hidden animate-fade-in"></section>
        <section id="franchiseSection" class="hidden animate-fade-in"></section>
    </main>
    
    <footer class="bg-gray-800 text-white pt-10 pb-5">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-6">
                <div>
                    <div class="flex items-center space-x-2 mb-3">
                        <img src="https://raw.githubusercontent.com/HienNguyenEMS/chacavungtau/refs/heads/main/logo.jpg" alt="Logo" class="w-10 h-10 rounded-lg">
                        <span class="font-bold text-lg">ƒê·ªìng Nh√¢n Food</span>
                    </div>
                    <p class="text-gray-400 text-sm">Mang nh·ªØng s·∫£n ph·∫©m ch·∫•t l∆∞·ª£ng, an to√†n v√† ti·ªán l·ª£i ƒë·∫øn m·ªçi nh√†.</p>
                </div>
                <div>
                    <h3 class="font-bold mb-3">Li√™n k·∫øt nhanh</h3>
                    <ul class="space-y-1.5 text-gray-400 text-sm">
                        <li><a href="#" onclick="event.preventDefault(); showSection('intro')" class="hover:text-white">Trang ch·ªß</a></li>
                        <li><a href="#" onclick="event.preventDefault(); showSection('menu')" class="hover:text-white">S·∫£n ph·∫©m</a></li>
                        <li><a href="#" onclick="event.preventDefault(); showSection('stores')" class="hover:text-white">C·ª≠a h√†ng</a></li>
                        <li><a href="#" onclick="event.preventDefault(); handleFranchiseClick()" class="hover:text-white">ƒêƒÉng k√Ω nh∆∞·ª£ng quy·ªÅn</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-3">Li√™n h·ªá</h3>
                    <ul class="space-y-1.5 text-gray-400 text-sm">
                        <li><strong>Hotline:</strong> 0934.945.967</li>
                        <li><strong>Email:</strong> lienhe@dongnhanfood.com</li>
                        <li><strong>Tr·ª• s·ªü:</strong> 3/564 ·∫§p 64, Xu√¢n Th·ªõi S∆°n, TPHCM</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-3">M·∫°ng x√£ h·ªôi</h3>
                     <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white">Facebook</a>
                        <a href="#" class="text-gray-400 hover:text-white">Zalo</a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-5 text-center text-sm text-gray-500">
                <p>&copy; 2025 ƒê·ªìng Nh√¢n Food. All Rights Reserved.<a href="#" class="hover:text-white mt-2 inline-block">Tuy√™n b·ªë quy·ªÅn ri√™ng t∆∞</a></p>
            </div>
        </div>
    </footer>

    <!-- MODALS -->
    <div id="paymentOptionsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"></div>
    <div id="bankingPaymentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"></div>
    <div id="debtWarningModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"></div>
</body>

<script>
// --- STATE MANAGEMENT ---
let cart = [];
let currentUser = null;
let isLoggedIn = false;
let orderHistory = [];
let currentCategory = 'all';
let discountPercent = 0;
let demoUsers = [
    { id: 1, name: 'Nguy·ªÖn VƒÉn A', email: 'demo@example.com', phone: '0901234567', password: '123456', debt: 150000, creditLimit: 200000, address: "123 ƒê∆∞·ªùng ABC, V≈©ng T√†u" }
];
const discountCodes = { 'DONGNHAN10': 10, 'DEAL20': 20 };

// --- TEMPLATES ---
const TEMPLATES = {
    intro: `
        <div class="bg-emerald-600 text-white rounded-2xl p-6 md:p-8 mb-10 card-shadow">
            <div class="text-center relative z-10">
                <h1 class="text-3xl md:text-5xl font-bold mb-3">B√°nh M√¨ Ngon - G·∫Øn K·∫øt C·ªông ƒê·ªìng</h1>
                <p class="text-md md:text-xl mb-6 text-emerald-100">S·∫£n ph·∫©m ch·∫•t l∆∞·ª£ng t·ª´ ƒê·ªìng Nh√¢n Food</p>
                <div class="flex flex-col sm:flex-row gap-3 justify-center items-center">
                    <div class="flex items-center space-x-2 bg-white bg-opacity-20 px-4 py-2 rounded-full">
                        <span class="text-xl">üìû</span><span class="font-semibold">Hotline: 0934.945.967</span>
                    </div>
                    <button onclick="showSection('menu')" class="bg-white text-emerald-600 px-6 py-2 rounded-full font-semibold hover:bg-emerald-50">Xem S·∫£n Ph·∫©m Ngay</button>
                </div>
            </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12 text-center">
            <div class="bg-white p-4 rounded-lg interactive-card"><div class="text-3xl mb-2">üåø</div><h3 class="text-lg font-bold mb-1">Nguy√™n Li·ªáu S·∫°ch</h3><p class="text-gray-600 text-sm">Ngu·ªìn nguy√™n li·ªáu ƒë∆∞·ª£c ch·ªçn l·ªçc k·ªπ l∆∞·ª°ng, ƒë·∫£m b·∫£o an to√†n v√† t∆∞∆°i ngon.</p></div>
            <div class="bg-white p-4 rounded-lg interactive-card"><div class="text-3xl mb-2">üõ°Ô∏è</div><h3 class="text-lg font-bold mb-1">An To√†n V·ªá Sinh</h3><p class="text-gray-600 text-sm">Quy tr√¨nh s·∫£n xu·∫•t hi·ªán ƒë·∫°i, ƒë·∫°t chu·∫©n an to√†n v·ªá sinh th·ª±c ph·∫©m.</p></div>
            <div class="bg-white p-4 rounded-lg interactive-card"><div class="text-3xl mb-2">üöö</div><h3 class="text-lg font-bold mb-1">Ti·ªán L·ª£i & Nhanh Ch√≥ng</h3><p class="text-gray-600 text-sm">H·ªá th·ªëng ph√¢n ph·ªëi r·ªông kh·∫Øp, mang s·∫£n ph·∫©m ƒë·∫øn tay b·∫°n nhanh nh·∫•t.</p></div>
        </div>
                <div class="bg-white rounded-lg card-shadow p-6 md:p-10 mb-12">
            <h2 class="text-2xl font-bold text-center text-emerald-800 mb-6">S·∫£n Ph·∫©m N·ªïi B·∫≠t</h2>
            <div id="featuredProductsGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
            <div class="text-center mt-6"><button onclick="showSection('menu')" class="bg-emerald-600 text-white px-6 py-2.5 rounded-full font-semibold hover:bg-emerald-700">Xem T·∫•t C·∫£ S·∫£n Ph·∫©m</button></div>
        </div>
        <div class="bg-white rounded-lg card-shadow p-6 md:p-10 mb-12 grid md:grid-cols-2 gap-8 items-center">
            <div>
                <h2 class="text-2xl font-bold text-emerald-800 mb-4">V·ªÅ ƒê·ªìng Nh√¢n Food</h2>
                <div class="text-gray-700 space-y-3">
                    <p>V·ªõi kinh nghi·ªám l√¢u nƒÉm, ƒê·ªìng Nh√¢n Food t·ª± h√†o mang ƒë·∫øn nh·ªØng s·∫£n ph·∫©m kh√¥ng ch·ªâ ngon mi·ªáng m√† c√≤n ƒë·∫£m b·∫£o an to√†n tuy·ªát ƒë·ªëi cho s·ª©c kh·ªèe. Ch√∫ng t√¥i chuy√™n:</p>
                    <ul class="space-y-2 list-inside list-disc marker:text-emerald-500">
                        <li>Cung c·∫•p Ch·∫£ C√° S·ª£i, Ch·∫£ C√° T∆∞∆°i, Ch·∫£ C√° Ch·ª£, Ch·∫£ C√° Nha Trang ch·∫•t l∆∞·ª£ng cao.</li>
                        <li>H∆∞·ªõng d·∫´n kh·ªüi nghi·ªáp m√¥ h√¨nh kinh doanh b√°nh m√¨ ch·∫£ c√° th√†nh c√¥ng.</li>
                        <li>Cung c·∫•p v√† cho thu√™ xe b√°nh m√¨, h·ªó tr·ª£ ƒë·ªëi t√°c t·ªëi ƒëa.</li>
                    </ul>
                </div>
            </div>
            <div class="aspect-w-16 aspect-h-9 rounded-lg overflow-hidden shadow-lg">
                 <iframe class="w-full h-full" src="https://www.youtube.com/embed/5kSmizoku8s" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>


        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center mb-12">
            <div class="bg-white rounded-lg card-shadow p-6 interactive-card">
                 <h2 class="text-2xl font-bold text-emerald-800 mb-4">D·ªãch V·ª• C·ªßa Ch√∫ng T√¥i</h2>
                <div class="space-y-4">
                    <div><h3 class="text-lg font-semibold mb-1">üì¶ Cung c·∫•p S·ªâ & L·∫ª</h3><p class="text-gray-600 text-sm">Cung c·∫•p s·∫£n ph·∫©m ch·∫•t l∆∞·ª£ng cho ƒë·ªëi t√°c nh√† h√†ng, qu√°n ƒÉn v√† kh√°ch h√†ng c√° nh√¢n v·ªõi gi√° c·∫£ c·∫°nh tranh.</p></div>
                    <div><h3 class="text-lg font-semibold mb-1">ü§ù Nh∆∞·ª£ng Quy·ªÅn Kinh Doanh</h3><p class="text-gray-600 text-sm">M√¥ h√¨nh kinh doanh th√†nh c√¥ng. Cung c·∫•p g√≥i nh∆∞·ª£ng quy·ªÅn to√†n di·ªán: ƒë√†o t·∫°o, nguy√™n li·ªáu, h·ªó tr·ª£ marketing.</p><button onclick="handleFranchiseClick()" class="mt-3 bg-amber-400 text-slate-800 px-5 py-2 rounded-lg hover:bg-amber-300 font-semibold text-sm">ƒêƒÉng k√Ω ngay</button></div>
                </div>
            </div>
            <div class="text-center"><img src="https://raw.githubusercontent.com/HienNguyenEMS/chacavungtau/refs/heads/main/logo.jpg" alt="ƒê·ªìng Nh√¢n Food" class="rounded-lg shadow-lg mx-auto max-w-sm w-full"></div>
        </div>
        
        <div class="gradient-bg text-white rounded-lg p-6 text-center"><h2 class="text-2xl font-bold mb-3">S·∫µn s√†ng th∆∞·ªüng th·ª©c s·∫£n ph·∫©m ch·∫•t l∆∞·ª£ng?</h2><button onclick="showSection('menu')" class="bg-white text-emerald-600 px-6 py-2.5 rounded-full font-semibold hover:bg-emerald-50 mt-2">ƒê·∫∑t H√†ng Ngay</button></div>`,
    menu: `<h2 class="text-3xl font-bold text-emerald-800 mb-8 text-center">S·∫£n Ph·∫©m C·ªßa Ch√∫ng T√¥i</h2>
           <div id="category-filters" class="flex flex-wrap justify-center gap-2 md:gap-4 mb-8">
               <button onclick="filterProducts('all', this)" class="category-btn active px-4 py-2 text-sm md:text-base md:px-6 rounded-full">T·∫•t c·∫£</button>
               <button onclick="filterProducts('banhmi', this)" class="category-btn bg-white border px-4 py-2 text-sm md:text-base md:px-6 rounded-full">B√°nh M√¨</button>
               <button onclick="filterProducts('chaca', this)" class="category-btn bg-white border px-4 py-2 text-sm md:text-base md:px-6 rounded-full">Ch·∫£ C√°</button>
               <button onclick="filterProducts('combo', this)" class="category-btn bg-white border px-4 py-2 text-sm md:text-base md:px-6 rounded-full">Combo</button>
           </div>
           <div id="productGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8"></div>`,
    stores: `<h2 class="text-3xl font-bold text-emerald-800 mb-8 text-center">H·ªá Th·ªëng C·ª≠a H√†ng</h2><div id="storeGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>`,
    cart: `<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Gi·ªè H√†ng C·ªßa B·∫°n</h2><div class="max-w-4xl mx-auto"><div id="cartItems" class="space-y-4"></div><div id="cartSummary" class="mt-6"></div><div id="cartActions" class="mt-8 text-center hidden"><button onclick="proceedToOrder()" class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 text-lg font-semibold">Ti·∫øn h√†nh thanh to√°n üõí</button></div></div>`,
    login: `<div class="max-w-md mx-auto bg-white rounded-lg card-shadow p-8"><h2 class="text-3xl font-bold text-center mb-8">ƒêƒÉng Nh·∫≠p</h2><form id="loginForm"><div class="space-y-4"><input type="text" id="loginIdentifier" required placeholder="Email ho·∫∑c SƒêT" class="w-full px-4 py-3 border rounded-lg"><input type="password" id="loginPassword" required placeholder="M·∫≠t kh·∫©u" class="w-full px-4 py-3 border rounded-lg"><button type="submit" class="w-full bg-emerald-600 text-white py-3 rounded-lg font-semibold">ƒêƒÉng nh·∫≠p</button></div></form><div id="loginMessage" class="mt-4 text-center text-sm"></div><p class="mt-6 text-center">Ch∆∞a c√≥ t√†i kho·∫£n? <button onclick="showSection('register')" class="text-emerald-600 font-medium">ƒêƒÉng k√Ω</button></p></div>`,
    register: `<div class="max-w-md mx-auto bg-white rounded-lg card-shadow p-8"><h2 class="text-3xl font-bold text-center mb-8">ƒêƒÉng K√Ω T√†i Kho·∫£n</h2><form id="registerForm"><div class="space-y-4"><input type="text" id="registerName" required placeholder="H·ªç v√† t√™n" class="w-full px-4 py-3 border rounded-lg"><input type="tel" id="registerPhone" required placeholder="S·ªë ƒëi·ªán tho·∫°i" class="w-full px-4 py-3 border rounded-lg"><input type="email" id="registerEmail" required placeholder="Email" class="w-full px-4 py-3 border rounded-lg"><input type="password" id="registerPassword" required minlength="6" placeholder="M·∫≠t kh·∫©u (√≠t nh·∫•t 6 k√Ω t·ª±)" class="w-full px-4 py-3 border rounded-lg"><button type="submit" class="w-full bg-emerald-600 text-white py-3 rounded-lg font-semibold">T·∫°o t√†i kho·∫£n</button></div></form><div id="registerMessage" class="mt-4 text-center text-sm"></div><p class="mt-6 text-center">ƒê√£ c√≥ t√†i kho·∫£n? <button onclick="showSection('login')" class="text-emerald-600 font-medium">ƒêƒÉng nh·∫≠p</button></p></div>`,
    dashboard: `<div class="max-w-6xl mx-auto"><div class="flex items-center justify-between mb-4"><h2 class="text-3xl font-bold">Dashboard</h2></div><div class="bg-white rounded-lg card-shadow"><div class="flex flex-wrap border-b"><button onclick="showDashboardTab('overview', this)" class="dashboard-tab active px-6 py-3 font-medium">T·ªïng quan</button><button onclick="showDashboardTab('orders', this)" class="dashboard-tab px-6 py-3 font-medium">ƒê∆°n h√†ng</button><button onclick="showDashboardTab('debt', this)" class="dashboard-tab px-6 py-3 font-medium">C√¥ng n·ª£</button><button onclick="showDashboardTab('profile', this)" class="dashboard-tab px-6 py-3 font-medium">T√†i kho·∫£n</button></div><div class="p-6"><div id="overviewTab" class="dashboard-content animate-fade-in"></div><div id="ordersTab" class="dashboard-content hidden animate-fade-in"></div><div id="debtTab" class="dashboard-content hidden animate-fade-in"></div><div id="profileTab" class="dashboard-content hidden animate-fade-in"></div></div></div></div>`,
    franchise: `<div class="max-w-3xl mx-auto bg-white rounded-lg card-shadow p-8"><h2 class="text-3xl font-bold text-center mb-2">ƒêƒÉng K√Ω Nh∆∞·ª£ng Quy·ªÅn & ƒê·∫°i L√Ω</h2><p class="text-center text-gray-600 mb-8">C√πng ƒê·ªìng Nh√¢n Food lan t·ªèa s·∫£n ph·∫©m ch·∫•t l∆∞·ª£ng</p><div class="grid md:grid-cols-2 gap-8"><form id="franchiseForm"><h3 class="text-xl font-semibold mb-4">Th√¥ng tin ƒëƒÉng k√Ω</h3><div class="space-y-4"><input type="text" id="franchiseName" required placeholder="H·ªç v√† t√™n" class="w-full px-4 py-2 border rounded-lg bg-gray-100"><input type="tel" id="franchisePhone" required placeholder="S·ªë ƒëi·ªán tho·∫°i" class="w-full px-4 py-2 border rounded-lg bg-gray-100"><input type="email" id="franchiseEmail" required placeholder="Email" class="w-full px-4 py-2 border rounded-lg bg-gray-100"><input type="text" id="franchiseArea" required placeholder="Khu v·ª±c mu·ªën kinh doanh" class="w-full px-4 py-2 border rounded-lg"><textarea id="franchiseMessage" placeholder="L·ªùi nh·∫Øn ho·∫∑c c√¢u h·ªèi th√™m..." rows="3" class="w-full px-4 py-2 border rounded-lg"></textarea><div class="flex items-start"><input type="checkbox" id="franchiseTerms" required class="mt-1 mr-2"><label for="franchiseTerms" class="text-sm text-gray-600">T√¥i ƒë√£ ƒë·ªçc v√† ƒë·ªìng √Ω v·ªõi <a href="#" class="text-emerald-600">c√°c ƒëi·ªÅu kho·∫£n nh∆∞·ª£ng quy·ªÅn</a>.</label></div><button type="submit" class="w-full bg-amber-400 text-slate-800 py-3 rounded-lg font-semibold hover:bg-amber-300">G·ª≠i Y√™u C·∫ßu</button></div></form><div><h3 class="text-xl font-semibold mb-4">Quy tr√¨nh & H∆∞·ªõng d·∫´n</h3><ul class="list-disc list-inside space-y-3 text-gray-700"><li><strong>B∆∞·ªõc 1:</strong> ƒêi·ªÅn v√† g·ª≠i th√¥ng tin c·ªßa b·∫°n qua form b√™n c·∫°nh.</li><li><strong>B∆∞·ªõc 2:</strong> ƒê·ªôi ng≈© c·ªßa ch√∫ng t√¥i s·∫Ω li√™n h·ªá l·∫°i trong v√≤ng 24 gi·ªù ƒë·ªÉ t∆∞ v·∫•n chi ti·∫øt.</li><li><strong>B∆∞·ªõc 3:</strong> Trao ƒë·ªïi, th·ªëng nh·∫•t c√°c ƒëi·ªÅu kho·∫£n v√† k√Ω k·∫øt h·ª£p ƒë·ªìng.</li><li><strong>B∆∞·ªõc 4:</strong> Ch√∫ng t√¥i s·∫Ω h·ªó tr·ª£ b·∫°n chu·∫©n b·ªã m·∫∑t b·∫±ng, ƒë√†o t·∫°o v√† b·∫Øt ƒë·∫ßu kinh doanh.</li></ul></div></div></div>`,
    paymentOptionsModal: `<div class="bg-white rounded-lg p-6 max-w-lg w-full animate-fade-in"><h3 class="text-2xl font-bold text-center mb-4">X√°c Nh·∫≠n Thanh To√°n</h3><div id="orderSummaryInModal" class="bg-emerald-50 p-4 rounded-lg mb-6 border text-sm space-y-2"></div><div class="space-y-4"><button onclick="selectPaymentMethod('banking')" class="w-full bg-emerald-600 text-white py-3 rounded-lg flex items-center justify-center space-x-2"><span>üí≥</span><span>Thanh to√°n Banking</span></button><button onclick="selectPaymentMethod('debt')" class="w-full bg-amber-500 text-white py-3 rounded-lg flex items-center justify-center space-x-2"><span>üìã</span><span>Ghi c√¥ng n·ª£</span></button></div><button onclick="closeModal('paymentOptionsModal')" class="w-full mt-6 bg-gray-300 py-2 rounded-lg">H·ªßy</button></div>`,
    bankingPaymentModal: `<div class="bg-white rounded-lg p-6 max-w-md w-full animate-fade-in"><h3 class="text-2xl font-bold mb-4 text-center">Thanh to√°n VietQR</h3><img id="bankingQrImage" src="" alt="VietQR Code" class="w-64 h-64 mx-auto bg-gray-100 rounded-lg border"><div class="my-4 text-sm bg-gray-50 p-3 rounded-lg"><p><strong>S·ªë ti·ªÅn:</strong> <span id="bankingAmount" class="text-emerald-700 font-bold"></span></p><p><strong>N·ªôi dung:</strong> <span id="bankingContent" class="text-emerald-700"></span></p></div><button onclick="confirmBankingPayment()" class="w-full bg-green-600 text-white py-3 rounded-lg">T√¥i ƒë√£ thanh to√°n</button><button onclick="closeModal('bankingPaymentModal')" class="w-full mt-3 bg-gray-300 py-2 rounded-lg">ƒê√≥ng</button></div>`,
    debtWarningModal: `<div class="bg-white rounded-lg p-6 max-w-lg w-full animate-fade-in"><h3 class="text-2xl font-bold text-red-600 text-center mb-4">‚ö†Ô∏è V∆∞·ª£t H·∫°n M·ª©c C√¥ng N·ª£</h3><div id="debtWarningContent" class="bg-red-50 p-4 rounded-lg border border-red-200 mb-4 text-sm space-y-2"></div><p class="text-center mb-4">Vui l√≤ng thanh to√°n c√¥ng n·ª£ c≈© ƒë·ªÉ ti·∫øp t·ª•c.</p><img id="debtQrImage" src="" alt="VietQR for Debt" class="w-56 h-56 mx-auto bg-gray-100 rounded-lg border"><button onclick="confirmDebtPayment()" class="w-full mt-4 bg-green-600 text-white py-3 rounded-lg">T√¥i ƒë√£ thanh to√°n c√¥ng n·ª£</button><button onclick="closeModal('debtWarningModal')" class="w-full mt-3 bg-gray-300 py-2 rounded-lg">ƒê√≥ng</button></div>`
};

// --- UI & NAVIGATION ---
function showSection(sectionName) {
    document.querySelectorAll('main > section').forEach(sec => sec.classList.add('hidden'));
    const sectionEl = document.getElementById(sectionName + 'Section');
    if (sectionEl) {
        sectionEl.innerHTML = TEMPLATES[sectionName] || '';
        sectionEl.classList.remove('hidden');
    }
    updateMobileNavigation(sectionName);
    window.scrollTo(0, 0);

    if (sectionName.match(/login|register/)) document.getElementById(`${sectionName}Form`).addEventListener('submit', sectionName === 'login' ? handleLogin : handleRegister);
    if (sectionName === 'intro') loadFeaturedProducts();
    if (sectionName === 'menu') filterProducts(currentCategory, document.querySelector('.category-btn.active'));
    if (sectionName === 'stores') loadStores();
    if (sectionName === 'cart') updateCartDisplay();
    if (sectionName === 'dashboard') loadDashboard();
    if (sectionName === 'franchise') {
       
        document.getElementById('franchiseForm').addEventListener('submit', handleFranchiseSubmit);
        prefillFranchiseForm();
    }
}

function updateMobileNavigation(activeSection) {
    document.querySelectorAll('.mobile-nav-btn').forEach(btn => btn.classList.toggle('active', btn.getAttribute('data-section') === activeSection));
}

function updateMenuVisibility() {
    const hasItems = cart.length > 0;
    document.getElementById('navCart').classList.toggle('hidden', !hasItems);
    const mobileNavCart = document.getElementById('mobileNavCart');
    mobileNavCart.classList.toggle('hidden', !hasItems);
    mobileNavCart.classList.toggle('flex', hasItems);
    
    const mobileNavGrid = document.getElementById('mobileNavGrid');
    let visibleItems = 2 + (hasItems ? 1 : 0) + 1; // home, products, account + cart if exists
    mobileNavGrid.style.gridTemplateColumns = `repeat(${visibleItems}, 1fr)`;
}

function closeModal(modalId) { 
    const modal = document.getElementById(modalId);
    if(modal) { modal.innerHTML = ''; modal.classList.add('hidden'); }
}

// --- CONTENT LOADING ---
function loadFeaturedProducts() {
    const grid = document.getElementById('featuredProductsGrid');
    if(grid) grid.innerHTML = products.slice(0, 3).map(p => `<div class="bg-gray-50 rounded-lg p-4 text-center interactive-card"><div class="h-40 bg-gray-200 flex items-center justify-center rounded-lg">${p.image}</div><h4 class="font-bold mt-4">${p.name}</h4><p class="text-emerald-600 font-semibold">${p.price.toLocaleString()}ƒë</p></div>`).join('');
}

function filterProducts(category, element) {
    currentCategory = category;
    document.querySelectorAll('#category-filters .category-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.classList.add('bg-white', 'border');
    });
    element.classList.add('active');
    element.classList.remove('bg-white', 'border');
    loadProducts();
}

function loadProducts() {
    const grid = document.getElementById('productGrid');
    if(!grid) return;
    const productsToDisplay = currentCategory === 'all' ? products : products.filter(p => p.category === currentCategory);

    grid.innerHTML = productsToDisplay.map(p => {
        const cartItem = cart.find(item => item.id === p.id);
        const quantity = cartItem ? cartItem.quantity : 0;
        
        const buttonHtml = quantity > 0
            ? `<div class="flex items-center justify-center gap-4">
                 <button onclick="updateCartQuantity(${p.id}, -1)" class="w-10 h-10 bg-gray-200 rounded-full font-bold text-lg">-</button>
                 <span class="text-xl font-semibold">${quantity}</span>
                 <button onclick="updateCartQuantity(${p.id}, 1)" class="w-10 h-10 bg-gray-200 rounded-full font-bold text-lg">+</button>
               </div>`
            : `<button onclick="addToCart(${p.id})" class="w-full text-white py-2 rounded-lg font-semibold bg-emerald-600 hover:bg-emerald-700">Th√™m v√†o gi·ªè h√†ng üõí</button>`;
            
        return `<div class="bg-white rounded-lg card-shadow overflow-hidden interactive-card"><div class="h-48 bg-gray-100 flex items-center justify-center">${p.image}</div><div class="p-4"><h3 class="font-bold text-lg">${p.name}</h3><p class="text-gray-600 text-sm h-10">${p.description}</p><div class="flex items-center justify-between mt-2 mb-4"><span class="text-xl font-bold text-emerald-600">${p.price.toLocaleString()}ƒë</span></div><div id="product-actions-${p.id}">${buttonHtml}</div></div></div>`;
    }).join('');
}


function loadStores() {
    const grid = document.getElementById('storeGrid');
    if(grid) grid.innerHTML = branches.map(b => `<div class="bg-white rounded-lg card-shadow p-6 border-l-4 border-amber-500 interactive-card"><h3 class="font-bold text-lg">${b.emoji} ${b.name}</h3><p class="text-sm text-gray-600 mt-2">üìç ${b.address}</p><p class="text-sm text-gray-600 mt-1">üìû ${b.phone}</p></div>`).join('');
}

// --- CART LOGIC ---
function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    cart.push({ ...product, quantity: 1 });
    showNotification(`${product.name} ƒë√£ ƒë∆∞·ª£c th√™m v√†o gi·ªè.`);
    updateAllUI();
}

function updateCartQuantity(productId, change) {
    const item = cart.find(item => item.id === productId);
    if (!item) { // If item not in cart, add it (case from product page)
        if(change > 0) addToCart(productId);
        return;
    }
    item.quantity += change;
    if (item.quantity <= 0) {
        cart = cart.filter(i => i.id !== productId);
    }
    updateAllUI();
}

function removeFromCart(productId) {
    cart = cart.filter(item => item.id !== productId);
    updateAllUI();
}

function updateCartDisplay() {
    const itemsEl = document.getElementById('cartItems');
    const summaryEl = document.getElementById('cartSummary');
    const actionsEl = document.getElementById('cartActions');
    if(!itemsEl) return;
    if (cart.length === 0) {
        itemsEl.innerHTML = `<div class="text-center py-12"><h3 class="text-xl text-gray-600">Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng.</h3><button onclick="showSection('menu')" class="mt-4 bg-emerald-600 text-white px-6 py-2 rounded-lg">Mua s·∫Øm ngay</button></div>`;
        summaryEl.innerHTML = '';
        actionsEl.classList.add('hidden');
    } else {
        itemsEl.innerHTML = cart.map(item => `<div class="bg-white rounded-lg card-shadow p-4 flex items-center gap-4"><div class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">${item.image}</div><div class="flex-1"><h3 class="font-semibold">${item.name}</h3><p class="text-emerald-600">${item.price.toLocaleString()}ƒë</p></div><div class="flex items-center gap-3"><button onclick="updateCartQuantity(${item.id}, -1)" class="w-8 h-8 bg-gray-200 rounded-full font-bold">-</button><span class="text-lg font-semibold">${item.quantity}</span><button onclick="updateCartQuantity(${item.id}, 1)" class="w-8 h-8 bg-gray-200 rounded-full font-bold">+</button></div><p class="font-bold text-lg w-24 text-right">${(item.price * item.quantity).toLocaleString()}ƒë</p><button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 p-2">‚úñ</button></div>`).join('');
        
        const subtotal = cart.reduce((s, i) => s + i.price * i.quantity, 0);
        const discountAmount = subtotal * (discountPercent / 100);
        const total = subtotal - discountAmount;

        summaryEl.innerHTML = `
            <div class="max-w-sm ml-auto bg-white p-6 rounded-lg card-shadow">
                <div class="flex justify-between items-center mb-4">
                    <input type="text" id="discountCodeInput" placeholder="Nh·∫≠p m√£ gi·∫£m gi√°" class="w-full px-3 py-2 border rounded-l-lg">
                    <button onclick="applyDiscount()" class="bg-gray-600 text-white px-4 py-2 rounded-r-lg hover:bg-gray-700">√Åp d·ª•ng</button>
                </div>
                <div id="discountMessage" class="text-sm mb-4"></div>
                <div class="space-y-2 border-t pt-4">
                    <div class="flex justify-between"><span class="text-gray-600">T·∫°m t√≠nh:</span><span>${subtotal.toLocaleString()}ƒë</span></div>
                    ${discountPercent > 0 ? `<div class="flex justify-between text-green-600"><span class="text-gray-600">Gi·∫£m gi√° (${discountPercent}%):</span><span>-${discountAmount.toLocaleString()}ƒë</span></div>` : ''}
                    <div class="flex justify-between text-xl font-bold"><span class="text-gray-800">T·ªïng c·ªông:</span><span class="text-emerald-600">${total.toLocaleString()}ƒë</span></div>
                </div>
            </div>
        `;

        actionsEl.classList.remove('hidden');
    }
}

function applyDiscount() {
    const code = document.getElementById('discountCodeInput').value.toUpperCase();
    const messageEl = document.getElementById('discountMessage');
    if (discountCodes[code]) {
        discountPercent = discountCodes[code];
        messageEl.innerHTML = `<p class="text-green-600">√Åp d·ª•ng m√£ th√†nh c√¥ng! B·∫°n ƒë∆∞·ª£c gi·∫£m ${discountPercent}%.</p>`;
    } else {
        discountPercent = 0;
        messageEl.innerHTML = `<p class="text-red-500">M√£ gi·∫£m gi√° kh√¥ng h·ª£p l·ªá.</p>`;
    }
    updateCartDisplay();
}

// --- PAYMENT & FRANCHISE FLOW ---
function proceedToOrder() {
    if (!isLoggedIn) { showNotification("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ thanh to√°n.", true); showSection('login'); return; }
    
    const subtotal = cart.reduce((s, i) => s + i.price * i.quantity, 0);
    const discountAmount = subtotal * (discountPercent / 100);
    const orderTotal = subtotal - discountAmount;
    const debt = currentUser.debt || 0;
    const finalTotal = orderTotal + debt;

    const modal = document.getElementById('paymentOptionsModal');
    modal.innerHTML = TEMPLATES.paymentOptionsModal;
    
    document.getElementById('orderSummaryInModal').innerHTML = `
        <div class="flex justify-between"><span>T·ªïng ƒë∆°n h√†ng m·ªõi:</span><strong>${orderTotal.toLocaleString()}ƒë</strong></div>
        ${discountPercent > 0 ? `<div class="flex justify-between text-green-600"><span>(ƒê√£ gi·∫£m ${discountAmount.toLocaleString()}ƒë)</span></div>` : ''}
        <div class="flex justify-between"><span>C√¥ng n·ª£ c≈©:</span><strong>${debt.toLocaleString()}ƒë</strong></div>
        <hr class="my-2">
        <div class="flex justify-between font-bold text-lg"><span class="text-gray-800">T·ªïng thanh to√°n:</span><strong class="text-emerald-600">${finalTotal.toLocaleString()}ƒë</strong></div>
    `;
    modal.classList.remove('hidden');
}

function selectPaymentMethod(method) {
    closeModal('paymentOptionsModal');
    method === 'banking' ? showBankingPayment() : checkDebtLimitAndProcess();
}

function generateVietQRUrl(amount, content) {
    const accountInfo = { bank: "970422", acc: "0934945967", name: "NGUYEN CHI THANH" };
    return `https://api.vietqr.io/v2/generate?accountNo=${accountInfo.acc}&accountName=${encodeURIComponent(accountInfo.name)}&acqId=${accountInfo.bank}&amount=${amount}&addInfo=${encodeURIComponent(content)}&template=compact2`;
}

function showBankingPayment() {
    const modal = document.getElementById('bankingPaymentModal');
    modal.innerHTML = TEMPLATES.bankingPaymentModal;
    const orderTotal = cart.reduce((s, i) => s + i.price * i.quantity, 0) * (1 - discountPercent / 100);
    const totalToPay = orderTotal + (currentUser.debt || 0);
    const orderId = 'DH' + Date.now().toString().slice(-6);
    const qrContent = `TT ${orderId}`;
    document.getElementById('bankingQrImage').src = generateVietQRUrl(totalToPay, qrContent);
    document.getElementById('bankingAmount').textContent = `${totalToPay.toLocaleString()}ƒë`;
    document.getElementById('bankingContent').textContent = qrContent;
    modal.classList.remove('hidden');
}

function confirmBankingPayment() {
    const total = cart.reduce((s, i) => s + i.price * i.quantity, 0) * (1 - discountPercent / 100);
    orderHistory.push({ id: orderHistory.length + 1, code: 'DH' + Date.now().toString().slice(-6), status: 'ƒêang x·ª≠ l√Ω', total: total, date: new Date() });
    currentUser.debt = 0; // Assume all debt is paid
    cart = [];
    discountPercent = 0;
    closeModal('bankingPaymentModal');
    showNotification("Thanh to√°n th√†nh c√¥ng! ƒê∆°n h√†ng ƒëang ƒë∆∞·ª£c x·ª≠ l√Ω.");
    updateAllUI();
    showSection('dashboard');
}

function checkDebtLimitAndProcess() {
    const orderTotal = cart.reduce((s, i) => s + i.price * i.quantity, 0) * (1 - discountPercent / 100);
    const newDebtTotal = (currentUser.debt || 0) + orderTotal;
    if (newDebtTotal > currentUser.creditLimit) {
        showDebtWarning(currentUser.debt, orderTotal, currentUser.creditLimit);
    } else {
        currentUser.debt = newDebtTotal;
        orderHistory.push({ id: orderHistory.length + 1, code: 'DH' + Date.now().toString().slice(-6), status: 'ƒêang x·ª≠ l√Ω (C√¥ng n·ª£)', total: orderTotal, date: new Date() });
        cart = [];
        discountPercent = 0;
        showNotification("ƒê·∫∑t h√†ng c√¥ng n·ª£ th√†nh c√¥ng!");
        updateAllUI();
        showSection('dashboard');
    }
}

function showDebtWarning(currentDebt, orderTotal, creditLimit) {
    const modal = document.getElementById('debtWarningModal');
    modal.innerHTML = TEMPLATES.debtWarningModal;
    document.getElementById('debtWarningContent').innerHTML = `<p>C√¥ng n·ª£ hi·ªán t·∫°i: <strong class="text-red-600">${currentDebt.toLocaleString()}ƒë</strong></p><p>ƒê∆°n h√†ng m·ªõi: <strong>${orderTotal.toLocaleString()}ƒë</strong></p><p>T·ªïng c√¥ng n·ª£ m·ªõi s·∫Ω l√† <strong class="text-red-600">${(currentDebt + orderTotal).toLocaleString()}ƒë</strong>, v∆∞·ª£t qu√° h·∫°n m·ª©c <strong>${creditLimit.toLocaleString()}ƒë</strong>.</p>`;
    document.getElementById('debtQrImage').src = generateVietQRUrl(currentDebt, `TT Cong No ${currentUser.phone}`);
    modal.classList.remove('hidden');
}

function confirmDebtPayment() {
    showNotification("Thanh to√°n c√¥ng n·ª£ th√†nh c√¥ng! Vui l√≤ng ƒë·∫∑t l·∫°i ƒë∆°n h√†ng.");
    currentUser.debt = 0;
    closeModal('debtWarningModal');
    updateAllUI();
}

function handleFranchiseClick() {
    if (isLoggedIn) showSection('franchise');
    else { showNotification("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒëƒÉng k√Ω.", true); showSection('login'); }
}

function prefillFranchiseForm() {
    if(isLoggedIn) {
        document.getElementById('franchiseName').value = currentUser.name;
        document.getElementById('franchisePhone').value = currentUser.phone;
        document.getElementById('franchiseEmail').value = currentUser.email;
    }
}

function handleFranchiseSubmit(event) {
    event.preventDefault();
    if (!document.getElementById('franchiseTerms').checked) {
        showNotification("B·∫°n ph·∫£i ƒë·ªìng √Ω v·ªõi ƒëi·ªÅu kho·∫£n ƒë·ªÉ ti·∫øp t·ª•c.", true); return;
    }
    showNotification("Y√™u c·∫ßu c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c g·ª≠i. Ch√∫ng t√¥i s·∫Ω li√™n h·ªá l·∫°i s·ªõm!");
    setTimeout(() => showSection('intro'), 2000);
}

// --- LOGIN & REGISTER & USER ---
function handleLogin(event) {
    event.preventDefault();
    const id = document.getElementById('loginIdentifier').value;
    const pass = document.getElementById('loginPassword').value;
    const user = demoUsers.find(u => (u.email === id || u.phone === id) && u.password === pass);
    if (user) {
        currentUser = user;
        isLoggedIn = true;
        showNotification(`Ch√†o m·ª´ng, ${currentUser.name}!`);
        updateAllUI();
        showSection('intro');
    } else {
        document.getElementById('loginMessage').innerHTML = `<p class="text-red-500">Th√¥ng tin kh√¥ng ch√≠nh x√°c.</p>`;
    }
}

function logout() {
    currentUser = null;
    isLoggedIn = false;
    showNotification('ƒê√£ ƒëƒÉng xu·∫•t!');
    updateAllUI();
    showSection('intro');
}

function handleRegister(event) {
    event.preventDefault();
    const [name, phone, email, pass] = ['registerName', 'registerPhone', 'registerEmail', 'registerPassword'].map(id => document.getElementById(id).value);
    const msgEl = document.getElementById('registerMessage');
    if (demoUsers.some(u => u.email === email || u.phone === phone)) {
        msgEl.innerHTML = `<p class="text-red-500">Email ho·∫∑c SƒêT ƒë√£ t·ªìn t·∫°i.</p>`; return;
    }
    const newUser = { id: Date.now(), name, email, phone, password: pass, debt: 0, creditLimit: 200000, address: "" };
    demoUsers.push(newUser);
    msgEl.innerHTML = `<p class="text-green-500">ƒêƒÉng k√Ω th√†nh c√¥ng! ƒêang t·ª± ƒë·ªông ƒëƒÉng nh·∫≠p...</p>`;
    setTimeout(() => {
        const user = demoUsers.find(u => u.email === email && u.password === pass);
        if(user) { currentUser = user; isLoggedIn = true; showNotification(`Ch√†o m·ª´ng, ${currentUser.name}!`); updateAllUI(); showSection('intro'); }
    }, 1500);
}

// --- DASHBOARD ---
function loadDashboard() { showDashboardTab('overview', document.querySelector('#dashboardSection .dashboard-tab')); }

function showDashboardTab(tabName, clickedElement) {
    document.querySelectorAll('.dashboard-content').forEach(el => el.classList.add('hidden'));
    document.getElementById(tabName + 'Tab').classList.remove('hidden');
    document.querySelectorAll('.dashboard-tab').forEach(btn => btn.classList.remove('active'));
    clickedElement.classList.add('active');

    if (tabName === 'overview') loadDashboardOverview();
    if (tabName === 'orders') loadOrders();
    if (tabName === 'debt') loadDebtInfo();
    if (tabName === 'profile') loadProfileInfo();
}

function loadDashboardOverview() {
    const el = document.getElementById('overviewTab');
    const processing = orderHistory.filter(o => o.status.includes('ƒêang x·ª≠ l√Ω')).length;
    el.innerHTML = `<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="bg-emerald-50 p-6 rounded-lg"><p class="font-medium text-emerald-600">T·ªïng ƒë∆°n h√†ng</p><p class="text-2xl font-bold">${orderHistory.length}</p></div>
        <div class="bg-amber-50 p-6 rounded-lg"><p class="font-medium text-amber-600">ƒêang x·ª≠ l√Ω</p><p class="text-2xl font-bold">${processing}</p></div>
        <div class="bg-red-50 p-6 rounded-lg"><p class="font-medium text-red-600">C√¥ng n·ª£</p><p class="text-2xl font-bold">${(currentUser.debt || 0).toLocaleString()}ƒë</p></div>
    </div>`;
}

function loadOrders() {
    const el = document.getElementById('ordersTab');
    if (orderHistory.length === 0) el.innerHTML = '<p>B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o.</p>';
    else el.innerHTML = `<h3 class="text-xl font-semibold mb-4">L·ªãch s·ª≠ ƒë∆°n h√†ng</h3><div class="space-y-4">${orderHistory.map(o => `<div class="bg-gray-50 p-4 rounded-lg shadow-sm"><p><strong>M√£ ƒêH:</strong> ${o.code}</p><p><strong>Ng√†y:</strong> ${o.date.toLocaleDateString('vi-VN')}</p><p><strong>T·ªïng ti·ªÅn:</strong> ${o.total.toLocaleString()}ƒë</p><p><strong>Tr·∫°ng th√°i:</strong> <span class="text-orange-500 font-semibold">${o.status}</span></p></div>`).join('')}</div>`;
}

function loadDebtInfo() {
    const el = document.getElementById('debtTab');
    el.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-sm max-w-md"><h3 class="font-bold text-lg mb-4">Th√¥ng Tin C√¥ng N·ª£</h3><div class="space-y-2"><p>C√¥ng n·ª£ hi·ªán t·∫°i: <strong class="text-red-500 text-xl">${(currentUser.debt || 0).toLocaleString()}ƒë</strong></p><p>H·∫°n m·ª©c t√≠n d·ª•ng: <strong>${(currentUser.creditLimit || 0).toLocaleString()}ƒë</strong></p></div><button onclick="showDebtWarning(currentUser.debt, 0)" class="w-full mt-4 bg-red-600 text-white py-2 rounded-lg">Thanh to√°n ngay</button></div>`;
}

function loadProfileInfo() {
    const el = document.getElementById('profileTab');
    el.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-sm max-w-md"><h3 class="font-bold text-lg mb-4">Th√¥ng Tin T√†i Kho·∫£n</h3><div class="space-y-2"><p><strong>H·ªç t√™n:</strong> ${currentUser.name}</p><p><strong>Email:</strong> ${currentUser.email}</p><p><strong>SƒêT:</strong> ${currentUser.phone}</p><p><strong>ƒê·ªãa ch·ªâ:</strong> ${currentUser.address || "Ch∆∞a c·∫≠p nh·∫≠t"}</p></div></div>`;
}


// --- UTILITY ---
function showNotification(message, isError = false) {
    const el = document.createElement('div');
    const bgColor = isError ? 'bg-red-500' : 'bg-green-500';
    el.className = `fixed top-20 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in`;
    el.textContent = message;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 3000);
}

function updateAllUI() {
    document.querySelectorAll('#cartCount, #mobileCartCount').forEach(el => { el.textContent = cart.reduce((total, item) => total + item.quantity, 0); });
    updateMenuVisibility();
    updateLoginUI();
    const visibleSection = document.querySelector('main > section:not(.hidden)');
    if (visibleSection) {
        const sectionId = visibleSection.id.replace('Section', '');
        if (sectionId === 'menu') loadProducts();
        if (sectionId === 'cart') updateCartDisplay();
    }
}

function updateLoginUI() {
    document.getElementById('notLoggedIn').classList.toggle('hidden', isLoggedIn);
    document.getElementById('loggedIn').classList.toggle('hidden', !isLoggedIn);
    if (isLoggedIn) document.getElementById('userName').textContent = currentUser.name.split(' ').pop();
}

function toggleUserDropdown() { document.getElementById('userDropdownMenu').classList.toggle('show'); }
function closeUserDropdown() { document.getElementById('userDropdownMenu').classList.remove('show'); }

// --- INITIALIZATION ---
document.addEventListener('DOMContentLoaded', () => {
    showSection('intro');
    updateAllUI();
    window.addEventListener('click', (e) => {
        if (!document.querySelector('.dropdown')?.contains(e.target)) closeUserDropdown();
    });
});

// --- DUMMY DATA ---
const products = [
    { id: 1, name: 'B√°nh m√¨ ch·∫£ c√°', price: 20000, category: 'banhmi', description: 'B√°nh m√¨ gi√≤n r·ª•m k·∫πp ch·∫£ c√° n√≥ng h·ªïi.', image: '<span class="text-5xl">ü•ñ</span>' },
    { id: 2, name: 'Ch·∫£ c√° t∆∞∆°i (kg)', price: 120000, category: 'chaca', description: 'Ch·∫£ c√° t∆∞∆°i nguy√™n ch·∫•t, dai ngon.', image: '<span class="text-5xl">üêü</span>' },
    { id: 3, name: 'Nem n∆∞·ªõng', price: 25000, category: 'banhmi', description: 'Nem n∆∞·ªõng th∆°m l·ª´ng, ƒë·∫≠m ƒë√† h∆∞∆°ng v·ªã.', image: '<span class="text-5xl">üç¢</span>' },
    { id: 4, name: 'X√¥i ch·∫£ c√°', price: 25000, category: 'combo', description: 'X√¥i n·∫øp d·∫ªo th∆°m ƒÉn c√πng ch·∫£ c√°.', image: '<span class="text-5xl">üçö</span>' },
    { id: 5, name: 'Combo gia ƒë√¨nh', price: 150000, category: 'combo', description: 'Combo ti·ªán l·ª£i cho c·∫£ gia ƒë√¨nh.', image: '<span class="text-5xl">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>' },
    { id: 6, name: 'Ch·∫£ c√° Nha Trang', price: 150000, category: 'chaca', description: 'ƒê·∫∑c s·∫£n Nha Trang ch√≠nh g·ªëc.', image: '<span class="text-5xl">üê†</span>' }
];
const branches = [
    { id: 'q1', name: 'Chi nh√°nh Qu·∫≠n 1', emoji: 'üè¢', address: '123 ƒê∆∞·ªùng A, Qu·∫≠n 1, TPHCM', phone: '028.123.4567' },
    { id: 'gv', name: 'Chi nh√°nh G√≤ V·∫•p', emoji: 'üè™', address: '456 ƒê∆∞·ªùng B, Qu·∫≠n G√≤ V·∫•p, TPHCM', phone: '028.234.5678' },
    { id: 'bt', name: 'Chi nh√°nh B√¨nh Th·∫°nh', emoji: 'üèòÔ∏è', address: '789 ƒê∆∞·ªùng C, Qu·∫≠n B√¨nh Th·∫°nh, TPHCM', phone: '028.456.7890' },
];
</script>
</html>
