<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch·∫£ C√° V≈©ng T√†u - ƒê·∫∑t H√†ng Online</title>
    
    <meta name="description" content="üêü ƒê·∫∑c s·∫£n bi·ªÉn t∆∞∆°i ngon - H∆∞∆°ng v·ªã ƒë·∫°i d∆∞∆°ng üåä - Ch·∫£ C√° V≈©ng T√†u chuy√™n cung c·∫•p ch·∫£ c√° t∆∞∆°i ngon, ƒë·∫∑t h√†ng online nhanh ch√≥ng">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .gradient-bg { background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 50%, #0369a1 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .animate-fade-in { animation: fadeIn 0.5s ease-in; }
        .dropdown { position: relative; }
        .dropdown-menu { 
            position: absolute; top: 100%; right: 0; background: white; 
            border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); 
            min-width: 200px; z-index: 50; transform: translateY(10px) scale(0.95);
            opacity: 0; visibility: hidden; transition: all 0.2s ease; 
        }
        .dropdown-menu.show { transform: translateY(0) scale(1); opacity: 1; visibility: visible; }
        .mobile-nav-btn.active { color: #2563eb; background-color: #eff6ff; }
        .dashboard-tab.active { border-bottom-width: 2px; border-color: #2563eb; color: #2563eb; }
        @media (max-width: 768px) {
            main { padding-bottom: 80px; }
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3 cursor-pointer" onclick="showSection('intro')">
                    <img src="https://raw.githubusercontent.com/HienNguyenEMS/chacavungtau/refs/heads/main/logo.jpg" alt="Logo" class="w-10 h-10 rounded-lg">
                    <div><h1 class="text-xl font-bold">ƒê·ªìng Nh√¢n Food</h1></div>
                </div>
                <nav class="hidden md:flex space-x-6 items-center">
                    <button onclick="showSection('intro')" class="hover:text-blue-200 transition-colors">Trang ch·ªß</button>
                    <button onclick="showSection('menu')" class="hover:text-blue-200 transition-colors">S·∫£n ph·∫©m</button>
                    <button onclick="showSection('stores')" class="hover:text-blue-200 transition-colors">C·ª≠a h√†ng</button>
                     <div class="relative group">
                        <button class="hover:text-blue-200 transition-colors cursor-pointer">Tra c·ª©u</button>
                        <div class="absolute top-full left-0 mt-2 bg-white rounded-lg shadow-lg py-2 min-w-[200px] opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <button onclick="showSection('tracking')" class="block w-full text-left px-4 py-2 text-gray-700 hover:bg-blue-50">üì¶ Tra c·ª©u ƒë∆°n h√†ng</button>
                            <button onclick="showSection('debt')" class="block w-full text-left px-4 py-2 text-gray-700 hover:bg-blue-50">üí≥ Tra c·ª©u c√¥ng n·ª£</button>
                        </div>
                    </div>
                    <button id="navCart" onclick="showSection('cart')" class="hover:text-blue-200 transition-colors relative hidden">
                        Gi·ªè h√†ng <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-xs rounded-full w-4 h-4 flex items-center justify-center">0</span>
                    </button>
                    <div id="userMenuContainer" class="relative">
                        <div id="notLoggedIn" class="flex space-x-3">
                            <button onclick="showSection('login')" class="bg-white bg-opacity-20 px-4 py-2 rounded-lg hover:bg-opacity-30">ƒêƒÉng nh·∫≠p</button>
                            <button onclick="showSection('register')" class="bg-amber-400 text-slate-800 px-4 py-2 rounded-lg hover:bg-amber-300 font-semibold">ƒêƒÉng k√Ω</button>
                        </div>
                        <div id="loggedIn" class="hidden">
                            <div class="dropdown">
                                <button onclick="toggleUserDropdown()" class="flex items-center space-x-2 bg-white bg-opacity-20 px-4 py-2 rounded-lg hover:bg-opacity-30">
                                    <span class="text-xl">üë§</span><span id="userName" class="font-medium"></span>
                                    <svg class="w-4 h-4 transition-transform" id="userDropdownIcon" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                                </button>
                                <div id="userDropdownMenu" class="dropdown-menu">
                                    <button onclick="showSection('dashboard'); closeUserDropdown();" class="w-full text-left px-4 py-2 text-gray-700 hover:bg-emerald-50 flex items-center space-x-2"><span>üìä</span><span>Dashboard</span></button>
                                    <hr class="my-1">
                                    <button onclick="logout(); closeUserDropdown();" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 flex items-center space-x-2"><span>üö™</span><span>ƒêƒÉng xu·∫•t</span></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>
    
    <!-- Mobile Bottom Navigation -->
    <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t z-40">
        <div id="mobileNavGrid" class="grid grid-cols-3 h-16">
            <button onclick="showSection('intro')" class="mobile-nav-btn flex flex-col items-center justify-center space-y-1 text-gray-600 active" data-section="intro">
                <span class="text-xl">üè†</span><span class="text-xs font-medium">Trang ch·ªß</span>
            </button>
            <button onclick="showSection('menu')" class="mobile-nav-btn flex flex-col items-center justify-center space-y-1 text-gray-600" data-section="menu">
                <span class="text-xl">ü•ñ</span><span class="text-xs font-medium">S·∫£n ph·∫©m</span>
            </button>
            <button id="mobileNavCart" onclick="showSection('cart')" class="mobile-nav-btn flex-col items-center justify-center space-y-1 text-gray-600 relative hidden" data-section="cart">
                <span class="text-xl">üõí</span><span class="text-xs font-medium">Gi·ªè h√†ng</span>
                <span id="mobileCartCount" class="absolute top-1 right-4 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">0</span>
            </button>
             <button onclick="isLoggedIn ? showSection('dashboard') : showSection('login')" class="mobile-nav-btn flex flex-col items-center justify-center space-y-1 text-gray-600" data-section="login">
                <span class="text-xl">üë§</span><span class="text-xs font-medium">T√†i kho·∫£n</span>
            </button>
        </div>
    </div>

    <main class="container mx-auto px-4 py-8">
        <section id="introSection" class="animate-fade-in"></section>
        <section id="menuSection" class="hidden animate-fade-in"></section>
        <section id="storesSection" class="hidden animate-fade-in"></section>
        <section id="cartSection" class="hidden animate-fade-in"></section>
        <section id="loginSection" class="hidden animate-fade-in"></section>
        <section id="registerSection" class="hidden animate-fade-in"></section>
        <section id="dashboardSection" class="hidden animate-fade-in"></section>
        <section id="trackingSection" class="hidden animate-fade-in"></section>
        <section id="debtSection" class="hidden animate-fade-in"></section>
    </main>
    
    <footer class="bg-slate-800 text-white pt-12 pb-6">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <img src="https://raw.githubusercontent.com/HienNguyenEMS/chacavungtau/refs/heads/main/logo.jpg" alt="Logo" class="w-10 h-10 rounded-lg">
                        <span class="font-bold text-lg">ƒê·ªìng Nh√¢n Food</span>
                    </div>
                    <p class="text-slate-400 text-sm">Mang nh·ªØng s·∫£n ph·∫©m ch·∫•t l∆∞·ª£ng, an to√†n v√† ti·ªán l·ª£i ƒë·∫øn m·ªçi nh√†.</p>
                </div>
                <div>
                    <h3 class="font-bold mb-4">Li√™n k·∫øt nhanh</h3>
                    <ul class="space-y-2 text-slate-400 text-sm">
                        <li><a href="#" onclick="event.preventDefault(); showSection('intro')" class="hover:text-white">Trang ch·ªß</a></li>
                        <li><a href="#" onclick="event.preventDefault(); showSection('menu')" class="hover:text-white">S·∫£n ph·∫©m</a></li>
                        <li><a href="#" onclick="event.preventDefault(); showSection('stores')" class="hover:text-white">C·ª≠a h√†ng</a></li>
                        <li><a href="#" onclick="event.preventDefault(); showSection('tracking')" class="hover:text-white">Tra c·ª©u ƒë∆°n h√†ng</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-4">Li√™n h·ªá</h3>
                    <ul class="space-y-2 text-slate-400 text-sm">
                        <li><strong>Hotline:</strong> 0934.945.967</li>
                        <li><strong>Email:</strong> lienhe@dongnhanfood.com</li>
                        <li><strong>Tr·ª• s·ªü:</strong> 3/564 ·∫§p 64, Xu√¢n Th·ªõi S∆°n, TPHCM</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-4">M·∫°ng x√£ h·ªôi</h3>
                     <div class="flex space-x-4">
                        <a href="#" class="text-slate-400 hover:text-white">Facebook</a>
                        <a href="#" class="text-slate-400 hover:text-white">Zalo</a>
                    </div>
                </div>
            </div>
            <div class="border-t border-slate-700 pt-6 text-center text-sm text-slate-500">
                <p>&copy; 2024 ƒê·ªìng Nh√¢n Food. All Rights Reserved.</p>
                <a href="#" class="hover:text-white mt-2 inline-block">Tuy√™n b·ªë quy·ªÅn ri√™ng t∆∞</a>
            </div>
        </div>
    </footer>


    <!-- MODALS -->
    <div id="paymentOptionsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"></div>
    <div id="bankingPaymentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"></div>
    <div id="debtWarningModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"></div>
</body>

<script>
// --- STATE MANAGEMENT ---
let cart = [];
let currentUser = null;
let isLoggedIn = false;
let orderHistory = [];
let demoUsers = [
    { id: 1, name: 'Nguy·ªÖn VƒÉn A', email: 'demo@example.com', phone: '0901234567', password: '123456', debt: 150000, creditLimit: 200000, address: "123 ƒê∆∞·ªùng ABC, V≈©ng T√†u" }
];

// --- TEMPLATES ---
const TEMPLATES = {
    intro: `
        <div class="bg-emerald-600 text-white rounded-2xl p-8 mb-12 card-shadow">
            <div class="text-center relative z-10">
                <h1 class="text-4xl md:text-5xl font-bold mb-4">B√°nh M√¨ Ngon - G·∫Øn K·∫øt C·ªông ƒê·ªìng</h1>
                <p class="text-lg md:text-xl mb-8 text-emerald-100">S·∫£n ph·∫©m ch·∫•t l∆∞·ª£ng t·ª´ ƒê·ªìng Nh√¢n Food</p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                    <div class="flex items-center space-x-2 bg-white bg-opacity-20 px-6 py-3 rounded-full">
                        <span class="text-2xl">üìû</span><span class="font-semibold text-lg">Hotline: 0934.945.967</span>
                    </div>
                    <button onclick="showSection('menu')" class="bg-white text-emerald-600 px-8 py-3 rounded-full font-semibold hover:bg-emerald-50">Xem S·∫£n Ph·∫©m Ngay</button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16 text-center">
            <div class="bg-white p-6 rounded-lg card-shadow"><div class="text-4xl mb-3">üåø</div><h3 class="text-xl font-bold mb-2">Nguy√™n Li·ªáu S·∫°ch</h3><p class="text-gray-600">Ngu·ªìn nguy√™n li·ªáu ƒë∆∞·ª£c ch·ªçn l·ªçc k·ªπ l∆∞·ª°ng, ƒë·∫£m b·∫£o an to√†n v√† t∆∞∆°i ngon.</p></div>
            <div class="bg-white p-6 rounded-lg card-shadow"><div class="text-4xl mb-3">üõ°Ô∏è</div><h3 class="text-xl font-bold mb-2">An To√†n V·ªá Sinh</h3><p class="text-gray-600">Quy tr√¨nh s·∫£n xu·∫•t hi·ªán ƒë·∫°i, ƒë·∫°t chu·∫©n an to√†n v·ªá sinh th·ª±c ph·∫©m.</p></div>
            <div class="bg-white p-6 rounded-lg card-shadow"><div class="text-4xl mb-3">üöö</div><h3 class="text-xl font-bold mb-2">Ti·ªán L·ª£i & Nhanh Ch√≥ng</h3><p class="text-gray-600">H·ªá th·ªëng ph√¢n ph·ªëi r·ªông kh·∫Øp, mang s·∫£n ph·∫©m ƒë·∫øn tay b·∫°n nhanh nh·∫•t.</p></div>
        </div>

        <div class="bg-white rounded-lg card-shadow p-8 md:p-12 mb-16">
            <h2 class="text-3xl font-bold text-center text-emerald-800 mb-8">S·∫£n Ph·∫©m N·ªïi B·∫≠t</h2>
            <div id="featuredProductsGrid" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>
            <div class="text-center mt-8"><button onclick="showSection('menu')" class="bg-emerald-600 text-white px-8 py-3 rounded-full font-semibold hover:bg-emerald-700">Xem T·∫•t C·∫£ S·∫£n Ph·∫©m</button></div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center mb-16">
            <div class="bg-white rounded-lg card-shadow p-8">
                 <h2 class="text-3xl font-bold text-emerald-800 mb-4">D·ªãch V·ª• C·ªßa Ch√∫ng T√¥i</h2>
                <div class="space-y-6">
                    <div><h3 class="text-xl font-semibold mb-2">üì¶ Cung c·∫•p S·ªâ & L·∫ª</h3><p class="text-gray-600">Ch√∫ng t√¥i cung c·∫•p c√°c s·∫£n ph·∫©m th·ª±c ph·∫©m ch·∫•t l∆∞·ª£ng cho ƒë·ªëi t√°c nh√† h√†ng, qu√°n ƒÉn v√† kh√°ch h√†ng c√° nh√¢n v·ªõi gi√° c·∫£ c·∫°nh tranh.</p></div>
                    <div><h3 class="text-xl font-semibold mb-2">ü§ù Nh∆∞·ª£ng Quy·ªÅn Kinh Doanh</h3><p class="text-gray-600">M√¥ h√¨nh kinh doanh ƒë√£ ƒë∆∞·ª£c ch·ª©ng minh th√†nh c√¥ng. Ch√∫ng t√¥i cung c·∫•p g√≥i nh∆∞·ª£ng quy·ªÅn to√†n di·ªán: ƒë√†o t·∫°o, cung c·∫•p nguy√™n li·ªáu, h·ªó tr·ª£ marketing.</p></div>
                </div>
            </div>
            <div class="text-center"><img src="https://raw.githubusercontent.com/HienNguyenEMS/chacavungtau/refs/heads/main/logo.jpg" alt="ƒê·ªìng Nh√¢n Food" class="rounded-lg shadow-lg mx-auto max-w-sm w-full"></div>
        </div>
        
        <div class="bg-emerald-600 text-white rounded-lg p-8 text-center"><h2 class="text-3xl font-bold mb-4">S·∫µn s√†ng th∆∞·ªüng th·ª©c s·∫£n ph·∫©m ch·∫•t l∆∞·ª£ng?</h2><button onclick="showSection('menu')" class="bg-white text-emerald-600 px-8 py-3 rounded-full font-semibold hover:bg-emerald-50 mt-4">ƒê·∫∑t H√†ng Ngay</button></div>`,
    menu: `<h2 class="text-3xl font-bold text-emerald-800 mb-8 text-center">S·∫£n Ph·∫©m C·ªßa Ch√∫ng T√¥i</h2><div id="productGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>`,
    stores: `
        <h2 class="text-3xl font-bold text-emerald-800 mb-8 text-center">H·ªá Th·ªëng C·ª≠a H√†ng</h2>
        <div id="storeGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>`,
    cart: `<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Gi·ªè H√†ng C·ªßa B·∫°n</h2><div class="max-w-4xl mx-auto"><div id="cartItems" class="space-y-4"></div><div id="cartActions" class="mt-8 text-center hidden"><button onclick="proceedToOrder()" class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 text-lg font-semibold">Ti·∫øn h√†nh thanh to√°n üõí</button></div></div>`,
    login: `<div class="max-w-md mx-auto bg-white rounded-lg card-shadow p-8"><h2 class="text-3xl font-bold text-center mb-8">ƒêƒÉng Nh·∫≠p</h2><form id="loginForm"><div class="space-y-4"><input type="text" id="loginIdentifier" required placeholder="Email ho·∫∑c SƒêT" class="w-full px-4 py-3 border rounded-lg"><input type="password" id="loginPassword" required placeholder="M·∫≠t kh·∫©u" class="w-full px-4 py-3 border rounded-lg"><button type="submit" class="w-full bg-emerald-600 text-white py-3 rounded-lg font-semibold">ƒêƒÉng nh·∫≠p</button></div></form><div id="loginMessage" class="mt-4 text-center text-sm"></div><p class="mt-6 text-center">Ch∆∞a c√≥ t√†i kho·∫£n? <button onclick="showSection('register')" class="text-emerald-600 font-medium">ƒêƒÉng k√Ω</button></p></div>`,
    register: `<div class="max-w-md mx-auto bg-white rounded-lg card-shadow p-8"><h2 class="text-3xl font-bold text-center mb-8">ƒêƒÉng K√Ω T√†i Kho·∫£n</h2><form id="registerForm"><div class="space-y-4"><input type="text" id="registerName" required placeholder="H·ªç v√† t√™n" class="w-full px-4 py-3 border rounded-lg"><input type="tel" id="registerPhone" required placeholder="S·ªë ƒëi·ªán tho·∫°i" class="w-full px-4 py-3 border rounded-lg"><input type="email" id="registerEmail" required placeholder="Email" class="w-full px-4 py-3 border rounded-lg"><input type="password" id="registerPassword" required minlength="6" placeholder="M·∫≠t kh·∫©u (√≠t nh·∫•t 6 k√Ω t·ª±)" class="w-full px-4 py-3 border rounded-lg"><button type="submit" class="w-full bg-emerald-600 text-white py-3 rounded-lg font-semibold">T·∫°o t√†i kho·∫£n</button></div></form><div id="registerMessage" class="mt-4 text-center text-sm"></div><p class="mt-6 text-center">ƒê√£ c√≥ t√†i kho·∫£n? <button onclick="showSection('login')" class="text-emerald-600 font-medium">ƒêƒÉng nh·∫≠p</button></p></div>`,
    dashboard: `<div class="max-w-6xl mx-auto"><div class="flex items-center justify-between mb-4"><h2 class="text-3xl font-bold">Dashboard</h2></div><div class="bg-white rounded-lg card-shadow"><div class="flex flex-wrap border-b"><button onclick="showDashboardTab('overview', this)" class="dashboard-tab active px-6 py-3 font-medium">T·ªïng quan</button><button onclick="showDashboardTab('orders', this)" class="dashboard-tab px-6 py-3 font-medium">ƒê∆°n h√†ng</button><button onclick="showDashboardTab('debt', this)" class="dashboard-tab px-6 py-3 font-medium">C√¥ng n·ª£</button><button onclick="showDashboardTab('profile', this)" class="dashboard-tab px-6 py-3 font-medium">T√†i kho·∫£n</button></div><div class="p-6"><div id="overviewTab" class="dashboard-content animate-fade-in"></div><div id="ordersTab" class="dashboard-content hidden animate-fade-in"></div><div id="debtTab" class="dashboard-content hidden animate-fade-in"></div><div id="profileTab" class="dashboard-content hidden animate-fade-in"></div></div></div></div>`,
    tracking: `<h2 class="text-3xl font-bold text-center mb-8">Tra C·ª©u ƒê∆°n H√†ng</h2><div class="max-w-md mx-auto bg-white rounded-lg card-shadow p-8"><p class="text-center text-gray-600 mb-4">Nh·∫≠p m√£ ƒë∆°n h√†ng ƒë·ªÉ ki·ªÉm tra tr·∫°ng th√°i</p><div class="flex gap-2"><input type="text" id="orderCode" placeholder="M√£ ƒë∆°n h√†ng (VD: DH123456)" class="w-full px-4 py-2 border rounded-lg"><button onclick="trackOrder()" class="bg-emerald-600 text-white px-6 rounded-lg">Tra c·ª©u</button></div><div id="trackingResult" class="mt-6"></div></div>`,
    debt: `<h2 class="text-3xl font-bold text-center mb-8">Tra C·ª©u C√¥ng N·ª£</h2><div class="max-w-md mx-auto bg-white rounded-lg card-shadow p-8"><p class="text-center text-gray-600 mb-4">Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ ki·ªÉm tra c√¥ng n·ª£</p><div class="flex gap-2"><input type="tel" id="debtPhone" placeholder="S·ªë ƒëi·ªán tho·∫°i" class="w-full px-4 py-2 border rounded-lg"><button onclick="checkDebt()" class="bg-emerald-600 text-white px-6 rounded-lg">Ki·ªÉm tra</button></div><div id="debtResult" class="mt-6"></div></div>`,
    paymentOptionsModal: `<div class="bg-white rounded-lg p-6 max-w-lg w-full animate-fade-in"><h3 class="text-2xl font-bold text-center mb-4">Ch·ªçn h√¨nh th·ª©c thanh to√°n</h3><div id="orderSummaryInModal" class="bg-emerald-50 p-4 rounded-lg mb-6 border"></div><div class="space-y-4"><button onclick="selectPaymentMethod('banking')" class="w-full bg-emerald-600 text-white py-3 rounded-lg flex items-center justify-center space-x-2"><span>üí≥</span><span>Thanh to√°n Banking</span></button><button onclick="selectPaymentMethod('debt')" class="w-full bg-amber-500 text-white py-3 rounded-lg flex items-center justify-center space-x-2"><span>üìã</span><span>Ghi c√¥ng n·ª£</span></button></div><button onclick="closeModal('paymentOptionsModal')" class="w-full mt-6 bg-gray-300 py-2 rounded-lg">H·ªßy</button></div>`,
    bankingPaymentModal: `<div class="bg-white rounded-lg p-6 max-w-md w-full animate-fade-in"><h3 class="text-2xl font-bold mb-4 text-center">Thanh to√°n VietQR</h3><img id="bankingQrImage" src="" alt="VietQR Code" class="w-64 h-64 mx-auto bg-gray-100 rounded-lg border"><div class="my-4 text-sm bg-gray-50 p-3 rounded-lg"><p><strong>S·ªë ti·ªÅn:</strong> <span id="bankingAmount" class="text-emerald-700 font-bold"></span></p><p><strong>N·ªôi dung:</strong> <span id="bankingContent" class="text-emerald-700"></span></p></div><button onclick="confirmBankingPayment()" class="w-full bg-green-600 text-white py-3 rounded-lg">T√¥i ƒë√£ thanh to√°n</button><button onclick="closeModal('bankingPaymentModal')" class="w-full mt-3 bg-gray-300 py-2 rounded-lg">ƒê√≥ng</button></div>`,
    debtWarningModal: `<div class="bg-white rounded-lg p-6 max-w-lg w-full animate-fade-in"><h3 class="text-2xl font-bold text-red-600 text-center mb-4">‚ö†Ô∏è V∆∞·ª£t H·∫°n M·ª©c C√¥ng N·ª£</h3><div id="debtWarningContent" class="bg-red-50 p-4 rounded-lg border border-red-200 mb-4 text-sm space-y-2"></div><p class="text-center mb-4">Vui l√≤ng thanh to√°n c√¥ng n·ª£ c≈© ƒë·ªÉ ti·∫øp t·ª•c.</p><img id="debtQrImage" src="" alt="VietQR for Debt" class="w-56 h-56 mx-auto bg-gray-100 rounded-lg border"><button onclick="confirmDebtPayment()" class="w-full mt-4 bg-green-600 text-white py-3 rounded-lg">T√¥i ƒë√£ thanh to√°n c√¥ng n·ª£</button><button onclick="closeModal('debtWarningModal')" class="w-full mt-3 bg-gray-300 py-2 rounded-lg">ƒê√≥ng</button></div>`
};

// --- UI & NAVIGATION ---
function showSection(sectionName) {
    document.querySelectorAll('main > section').forEach(sec => sec.classList.add('hidden'));
    const sectionEl = document.getElementById(sectionName + 'Section');
    if (sectionEl) {
        sectionEl.innerHTML = TEMPLATES[sectionName] || '';
        sectionEl.classList.remove('hidden');
    }
    updateMobileNavigation(sectionName);
    window.scrollTo(0, 0);

    if (sectionName.match(/login|register/)) {
        document.getElementById(`${sectionName}Form`).addEventListener('submit', sectionName === 'login' ? handleLogin : handleRegister);
    }
    if (sectionName === 'intro') loadFeaturedProducts();
    if (sectionName === 'menu') loadProducts();
    if (sectionName === 'stores') loadStores();
    if (sectionName === 'cart') updateCartDisplay();
    if (sectionName === 'dashboard') loadDashboard();
}

function updateMobileNavigation(activeSection) {
    document.querySelectorAll('.mobile-nav-btn').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-section') === activeSection);
    });
}

function updateMenuVisibility() {
    const hasItems = cart.length > 0;
    document.getElementById('navCart').classList.toggle('hidden', !hasItems);
    const mobileNavCart = document.getElementById('mobileNavCart');
    mobileNavCart.classList.toggle('hidden', !hasItems);
    mobileNavCart.classList.toggle('flex', hasItems);
    
    const mobileNavGrid = document.getElementById('mobileNavGrid');
    let visibleItems = 2 + (hasItems ? 1 : 0) + 1; // home, products, account + cart if exists
    mobileNavGrid.style.gridTemplateColumns = `repeat(${visibleItems}, 1fr)`;
}

function closeModal(modalId) { 
    const modal = document.getElementById(modalId);
    if(modal) {
        modal.innerHTML = ''; 
        modal.classList.add('hidden');
    }
}

// --- CONTENT LOADING ---
function loadFeaturedProducts() {
    const grid = document.getElementById('featuredProductsGrid');
    if(grid) grid.innerHTML = products.slice(0, 3).map(p => {
        return `<div class="bg-gray-50 rounded-lg p-4 text-center">
            <div class="h-40 bg-gray-200 flex items-center justify-center rounded-lg">${p.image}</div>
            <h4 class="font-bold mt-4">${p.name}</h4>
            <p class="text-emerald-600 font-semibold">${p.price.toLocaleString()}ƒë</p>
        </div>`;
    }).join('');
}

function loadProducts() {
    const grid = document.getElementById('productGrid');
    if(grid) grid.innerHTML = products.map(p => {
        const inCart = cart.some(item => item.id === p.id);
        const btn = {
            class: inCart ? "bg-green-600 hover:bg-green-700" : "bg-emerald-600 hover:bg-emerald-700",
            text: inCart ? "T·ªõi gi·ªè h√†ng ‚úÖ" : "Th√™m v√†o gi·ªè h√†ng üõí",
            action: inCart ? "showSection('cart')" : `addToCart(${p.id})`
        };
        return `<div class="bg-white rounded-lg card-shadow overflow-hidden"><div class="h-48 bg-gray-100 flex items-center justify-center">${p.image}</div><div class="p-4"><h3 class="font-bold text-lg">${p.name}</h3><p class="text-gray-600 text-sm h-10">${p.description}</p><div class="flex items-center justify-between mt-2 mb-4"><span class="text-xl font-bold text-emerald-600">${p.price.toLocaleString()}ƒë</span></div><button id="product-btn-${p.id}" onclick="${btn.action}" class="w-full text-white py-2 rounded-lg font-semibold ${btn.class}">${btn.text}</button></div></div>`;
    }).join('');
}

function loadStores() {
    const grid = document.getElementById('storeGrid');
    if(grid) grid.innerHTML = branches.map(b => `<div class="bg-white rounded-lg card-shadow p-6 border-l-4 border-amber-500"><h3 class="font-bold text-lg">${b.emoji} ${b.name}</h3><p class="text-sm text-gray-600 mt-2">üìç ${b.address}</p><p class="text-sm text-gray-600 mt-1">üìû ${b.phone}</p></div>`).join('');
}

// --- CART LOGIC ---
function addToCart(productId) {
    if (cart.some(item => item.id === productId)) return;
    const product = products.find(p => p.id === productId);
    cart.push({ ...product, quantity: 1 });
    showNotification(`${product.name} ƒë√£ ƒë∆∞·ª£c th√™m v√†o gi·ªè.`);
    updateAllUI();
}

function removeFromCart(productId) {
    cart = cart.filter(item => item.id !== productId);
    updateAllUI();
}

function updateCartDisplay() {
    const itemsEl = document.getElementById('cartItems');
    const actionsEl = document.getElementById('cartActions');
    if(!itemsEl) return;
    if (cart.length === 0) {
        itemsEl.innerHTML = `<div class="text-center py-12"><h3 class="text-xl text-gray-600">Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng.</h3><button onclick="showSection('menu')" class="mt-4 bg-emerald-600 text-white px-6 py-2 rounded-lg">Mua s·∫Øm ngay</button></div>`;
        actionsEl.classList.add('hidden');
    } else {
        const total = cart.reduce((s, i) => s + i.price * i.quantity, 0);
        itemsEl.innerHTML = cart.map(item => `<div class="bg-white rounded-lg card-shadow p-4 flex items-center gap-4"><div class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">${item.image}</div><div class="flex-1"><h3 class="font-semibold">${item.name}</h3><p class="text-emerald-600">${item.price.toLocaleString()}ƒë</p></div><p class="font-bold text-lg">${(item.price * item.quantity).toLocaleString()}ƒë</p><button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 p-2">‚úñ</button></div>`).join('') + `<div class="text-right mt-4 text-xl font-bold">T·ªïng c·ªông: <span class="text-emerald-600">${total.toLocaleString()}ƒë</span></div>`;
        actionsEl.classList.remove('hidden');
    }
}

// --- PAYMENT FLOW ---
function proceedToOrder() {
    if (!isLoggedIn) {
        showNotification("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ thanh to√°n.");
        showSection('login');
        return;
    }
    const modal = document.getElementById('paymentOptionsModal');
    modal.innerHTML = TEMPLATES.paymentOptionsModal;
    const total = cart.reduce((s, i) => s + (i.price * i.quantity), 0);
    document.getElementById('orderSummaryInModal').innerHTML = `<p class="text-center">T·ªïng ti·ªÅn: <strong class="text-emerald-600">${total.toLocaleString()}ƒë</strong></p>`;
    modal.classList.remove('hidden');
}

function selectPaymentMethod(method) {
    closeModal('paymentOptionsModal');
    method === 'banking' ? showBankingPayment() : checkDebtLimitAndProcess();
}

function generateVietQRUrl(amount, content) {
    const accountInfo = { bank: "970422", acc: "0934945967", name: "NGUYEN CHI THANH" };
    return `https://api.vietqr.io/v2/generate?accountNo=${accountInfo.acc}&accountName=${encodeURIComponent(accountInfo.name)}&acqId=${accountInfo.bank}&amount=${amount}&addInfo=${encodeURIComponent(content)}&template=compact2`;
}

function showBankingPayment() {
    const modal = document.getElementById('bankingPaymentModal');
    modal.innerHTML = TEMPLATES.bankingPaymentModal;
    const total = cart.reduce((s, i) => s + i.price * i.quantity, 0);
    const orderId = 'DH' + Date.now().toString().slice(-6);
    const qrContent = `TT ${orderId}`;
    document.getElementById('bankingQrImage').src = generateVietQRUrl(total, qrContent);
    document.getElementById('bankingAmount').textContent = `${total.toLocaleString()}ƒë`;
    document.getElementById('bankingContent').textContent = qrContent;
    modal.classList.remove('hidden');
}

function confirmBankingPayment() {
    const total = cart.reduce((s, i) => s + i.price * i.quantity, 0);
    orderHistory.push({ id: orderHistory.length + 1, code: 'DH' + Date.now().toString().slice(-6), status: 'ƒêang x·ª≠ l√Ω', total: total, date: new Date() });
    cart = [];
    closeModal('bankingPaymentModal');
    showNotification("Thanh to√°n th√†nh c√¥ng! ƒê∆°n h√†ng ƒëang ƒë∆∞·ª£c x·ª≠ l√Ω.");
    updateAllUI();
    showSection('dashboard');
}

function checkDebtLimitAndProcess() {
    const total = cart.reduce((s, i) => s + i.price * i.quantity, 0);
    const newDebt = (currentUser.debt || 0) + total;
    if (newDebt > currentUser.creditLimit) {
        showDebtWarning(currentUser.debt, newDebt - currentUser.creditLimit);
    } else {
        currentUser.debt = newDebt;
        orderHistory.push({ id: orderHistory.length + 1, code: 'DH' + Date.now().toString().slice(-6), status: 'ƒêang x·ª≠ l√Ω (C√¥ng n·ª£)', total: total, date: new Date() });
        cart = [];
        showNotification("ƒê·∫∑t h√†ng c√¥ng n·ª£ th√†nh c√¥ng!");
        updateAllUI();
        showSection('dashboard');
    }
}

function showDebtWarning(currentDebt, amountOver) {
    const modal = document.getElementById('debtWarningModal');
    modal.innerHTML = TEMPLATES.debtWarningModal;
    document.getElementById('debtWarningContent').innerHTML = `<p>C√¥ng n·ª£ hi·ªán t·∫°i: <strong class="text-red-600">${currentDebt.toLocaleString()}ƒë</strong></p><p>ƒê∆°n h√†ng n√†y s·∫Ω v∆∞·ª£t h·∫°n m·ª©c: <strong class="text-red-600">${amountOver.toLocaleString()}ƒë</strong></p>`;
    document.getElementById('debtQrImage').src = generateVietQRUrl(currentDebt, `TT Cong No ${currentUser.phone}`);
    modal.classList.remove('hidden');
}

function confirmDebtPayment() {
    showNotification("Thanh to√°n c√¥ng n·ª£ th√†nh c√¥ng! Vui l√≤ng ƒë·∫∑t l·∫°i ƒë∆°n h√†ng.");
    currentUser.debt = 0;
    closeModal('debtWarningModal');
    updateAllUI();
}

// --- LOGIN & REGISTER & USER ---
function handleLogin(event) {
    event.preventDefault();
    const id = document.getElementById('loginIdentifier').value;
    const pass = document.getElementById('loginPassword').value;
    const user = demoUsers.find(u => (u.email === id || u.phone === id) && u.password === pass);
    if (user) {
        currentUser = user;
        isLoggedIn = true;
        showNotification(`Ch√†o m·ª´ng, ${currentUser.name}!`);
        updateAllUI();
        showSection('intro');
    } else {
        document.getElementById('loginMessage').innerHTML = `<p class="text-red-500">Th√¥ng tin kh√¥ng ch√≠nh x√°c.</p>`;
    }
}

function logout() {
    currentUser = null;
    isLoggedIn = false;
    showNotification('ƒê√£ ƒëƒÉng xu·∫•t!');
    updateAllUI();
    showSection('intro');
}

function handleRegister(event) {
    event.preventDefault();
    const [name, phone, email, pass] = ['registerName', 'registerPhone', 'registerEmail', 'registerPassword'].map(id => document.getElementById(id).value);
    const msgEl = document.getElementById('registerMessage');
    if (demoUsers.some(u => u.email === email || u.phone === phone)) {
        msgEl.innerHTML = `<p class="text-red-500">Email ho·∫∑c SƒêT ƒë√£ t·ªìn t·∫°i.</p>`; return;
    }
    const newUser = { id: Date.now(), name, email, phone, password: pass, debt: 0, creditLimit: 200000, address: "" };
    demoUsers.push(newUser);
    msgEl.innerHTML = `<p class="text-green-500">ƒêƒÉng k√Ω th√†nh c√¥ng! ƒêang t·ª± ƒë·ªông ƒëƒÉng nh·∫≠p...</p>`;
    setTimeout(() => {
        const user = demoUsers.find(u => u.email === email && u.password === pass);
        if(user) { currentUser = user; isLoggedIn = true; showNotification(`Ch√†o m·ª´ng, ${currentUser.name}!`); updateAllUI(); showSection('intro'); }
    }, 1500);
}

// --- DASHBOARD ---
function loadDashboard() {
    showDashboardTab('overview', document.querySelector('#dashboardSection .dashboard-tab'));
}

function showDashboardTab(tabName, clickedElement) {
    document.querySelectorAll('.dashboard-content').forEach(el => el.classList.add('hidden'));
    document.getElementById(tabName + 'Tab').classList.remove('hidden');
    document.querySelectorAll('.dashboard-tab').forEach(btn => btn.classList.remove('active'));
    clickedElement.classList.add('active');

    if (tabName === 'overview') loadDashboardOverview();
    if (tabName === 'orders') loadOrders();
    if (tabName === 'debt') loadDebtInfo();
    if (tabName === 'profile') loadProfileInfo();
}

function loadDashboardOverview() {
    const el = document.getElementById('overviewTab');
    const processing = orderHistory.filter(o => o.status.includes('ƒêang x·ª≠ l√Ω')).length;
    el.innerHTML = `<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="bg-emerald-50 p-6 rounded-lg"><p class="font-medium text-emerald-600">T·ªïng ƒë∆°n h√†ng</p><p class="text-2xl font-bold">${orderHistory.length}</p></div>
        <div class="bg-amber-50 p-6 rounded-lg"><p class="font-medium text-amber-600">ƒêang x·ª≠ l√Ω</p><p class="text-2xl font-bold">${processing}</p></div>
        <div class="bg-red-50 p-6 rounded-lg"><p class="font-medium text-red-600">C√¥ng n·ª£</p><p class="text-2xl font-bold">${(currentUser.debt || 0).toLocaleString()}ƒë</p></div>
    </div>`;
}

function loadOrders() {
    const el = document.getElementById('ordersTab');
    if (orderHistory.length === 0) el.innerHTML = '<p>B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o.</p>';
    else el.innerHTML = `<h3 class="text-xl font-semibold mb-4">L·ªãch s·ª≠ ƒë∆°n h√†ng</h3><div class="space-y-4">${orderHistory.map(o => `<div class="bg-gray-50 p-4 rounded-lg shadow-sm"><p><strong>M√£ ƒêH:</strong> ${o.code}</p><p><strong>Ng√†y:</strong> ${o.date.toLocaleDateString('vi-VN')}</p><p><strong>T·ªïng ti·ªÅn:</strong> ${o.total.toLocaleString()}ƒë</p><p><strong>Tr·∫°ng th√°i:</strong> <span class="text-orange-500 font-semibold">${o.status}</span></p></div>`).join('')}</div>`;
}

function loadDebtInfo() {
    const el = document.getElementById('debtTab');
    el.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-sm max-w-md"><h3 class="font-bold text-lg mb-4">Th√¥ng Tin C√¥ng N·ª£</h3><div class="space-y-2"><p>C√¥ng n·ª£ hi·ªán t·∫°i: <strong class="text-red-500 text-xl">${(currentUser.debt || 0).toLocaleString()}ƒë</strong></p><p>H·∫°n m·ª©c t√≠n d·ª•ng: <strong>${(currentUser.creditLimit || 0).toLocaleString()}ƒë</strong></p></div><button onclick="showDebtWarning(currentUser.debt, 0)" class="w-full mt-4 bg-red-600 text-white py-2 rounded-lg">Thanh to√°n ngay</button></div>`;
}

function loadProfileInfo() {
    const el = document.getElementById('profileTab');
    el.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-sm max-w-md"><h3 class="font-bold text-lg mb-4">Th√¥ng Tin T√†i Kho·∫£n</h3><div class="space-y-2"><p><strong>H·ªç t√™n:</strong> ${currentUser.name}</p><p><strong>Email:</strong> ${currentUser.email}</p><p><strong>SƒêT:</strong> ${currentUser.phone}</p><p><strong>ƒê·ªãa ch·ªâ:</strong> ${currentUser.address || "Ch∆∞a c·∫≠p nh·∫≠t"}</p></div></div>`;
}

// --- TRACKING & DEBT (Public) ---
function trackOrder() {
    const code = document.getElementById('orderCode').value.toUpperCase();
    const resultEl = document.getElementById('trackingResult');
    const order = orderHistory.find(o => o.code === code);
    resultEl.innerHTML = order ? `<div class="bg-green-50 p-4 rounded-lg"><p>ƒê∆°n h√†ng <strong>${code}</strong></p><p>Tr·∫°ng th√°i: <span class="font-semibold text-green-700">${order.status}</span></p></div>` : `<div class="bg-red-50 p-4 rounded-lg"><p>Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng <strong>${code}</strong>.</p></div>`;
}

function checkDebt() {
    const phone = document.getElementById('debtPhone').value;
    const resultEl = document.getElementById('debtResult');
    const user = demoUsers.find(u => u.phone === phone);
    resultEl.innerHTML = user ? `<div class="bg-emerald-50 p-4 rounded-lg"><p>Kh√°ch h√†ng: <strong>${user.name}</strong></p><p>C√¥ng n·ª£: <span class="font-semibold text-red-500">${(user.debt || 0).toLocaleString()}ƒë</span></p></div>` : `<div class="bg-red-50 p-4 rounded-lg"><p>Kh√¥ng t√¨m th·∫•y th√¥ng tin cho SƒêT n√†y.</p></div>`;
}

// --- UTILITY ---
function showNotification(message) {
    const el = document.createElement('div');
    el.className = 'fixed top-20 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in';
    el.textContent = message;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 3000);
}

function updateAllUI() {
    document.querySelectorAll('#cartCount, #mobileCartCount').forEach(el => { el.textContent = cart.length; });
    updateMenuVisibility();
    updateLoginUI();
    const visibleSection = document.querySelector('main > section:not(.hidden)');
    if (visibleSection) {
        const sectionId = visibleSection.id.replace('Section', '');
        if (sectionId === 'menu') loadProducts();
        if (sectionId === 'cart') updateCartDisplay();
    }
}

function updateLoginUI() {
    document.getElementById('notLoggedIn').classList.toggle('hidden', isLoggedIn);
    document.getElementById('loggedIn').classList.toggle('hidden', !isLoggedIn);
    if (isLoggedIn) document.getElementById('userName').textContent = currentUser.name.split(' ').pop();
}

function toggleUserDropdown() { document.getElementById('userDropdownMenu').classList.toggle('show'); }
function closeUserDropdown() { document.getElementById('userDropdownMenu').classList.remove('show'); }

// --- INITIALIZATION ---
document.addEventListener('DOMContentLoaded', () => {
    showSection('intro');
    updateAllUI();
    window.addEventListener('click', (e) => {
        if (!document.querySelector('.dropdown')?.contains(e.target)) closeUserDropdown();
    });
});

// --- DUMMY DATA ---
const products = [
    { id: 1, name: 'B√°nh m√¨ ch·∫£ c√°', price: 20000, description: 'B√°nh m√¨ gi√≤n r·ª•m k·∫πp ch·∫£ c√° n√≥ng h·ªïi.', image: '<span class="text-5xl">ü•ñ</span>' },
    { id: 2, name: 'Ch·∫£ c√° t∆∞∆°i (kg)', price: 120000, description: 'Ch·∫£ c√° t∆∞∆°i nguy√™n ch·∫•t, dai ngon.', image: '<span class="text-5xl">üêü</span>' },
    { id: 3, name: 'Nem n∆∞·ªõng', price: 25000, description: 'Nem n∆∞·ªõng th∆°m l·ª´ng, ƒë·∫≠m ƒë√† h∆∞∆°ng v·ªã.', image: '<span class="text-5xl">üç¢</span>' },
    { id: 4, name: 'X√¥i ch·∫£ c√°', price: 25000, description: 'X√¥i n·∫øp d·∫ªo th∆°m ƒÉn c√πng ch·∫£ c√°.', image: '<span class="text-5xl">üçö</span>' },
    { id: 5, name: 'Combo gia ƒë√¨nh', price: 150000, description: 'Combo ti·ªán l·ª£i cho c·∫£ gia ƒë√¨nh.', image: '<span class="text-5xl">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>' },
    { id: 6, name: 'N∆∞·ªõc m·∫Øm', price: 50000, description: 'N∆∞·ªõc m·∫Øm truy·ªÅn th·ªëng, nguy√™n ch·∫•t.', image: '<span class="text-5xl">üçØ</span>' }
];
const branches = [
    { id: 'vt-center', name: 'Chi nh√°nh Trung t√¢m', emoji: 'üè¢', address: '123 ƒê∆∞·ªùng A, Qu·∫≠n 1, TPHCM', phone: '028.123.4567' },
    { id: 'vt-back-beach', name: 'Chi nh√°nh G√≤ V·∫•p', emoji: 'üè™', address: '456 ƒê∆∞·ªùng B, Qu·∫≠n G√≤ V·∫•p, TPHCM', phone: '028.234.5678' },
    { id: 'ba-ria', name: 'Chi nh√°nh B√¨nh Th·∫°nh', emoji: 'üèòÔ∏è', address: '789 ƒê∆∞·ªùng C, Qu·∫≠n B√¨nh Th·∫°nh, TPHCM', phone: '028.456.7890' },
];
</script>
</html>
